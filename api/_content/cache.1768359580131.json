{"generatedAt":1768359608056,"generateTime":3032,"contents":[{"_path":"/post/20201026-build-your-blog-with-nuxt-and-nuxt-content-1","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"利用 Nuxt.js 與 nuxt/content 搭建部落格 (1)","description":"利用 Nuxt.js 與 nuxt/content 搭建部落格 (1)","tags":"nuxt, nuxt content, nuxt2, vue, vue2, jamstack","customCreatedAt":"2020-10-26T14:36:12.000Z","readingTime":{"text":"4 min read","minutes":3.055,"time":183300,"words":611},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"轉職工程師至今也已經過了一年多了，也開始興起想要記錄自己學習歷程的想法。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"「不如就架設一個技術部落格吧！」，我對自己這樣說。有了這個念頭之後，便開始去尋找到底哪裡適合架設部落格。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一般常見的網誌平台，例如 "},{"type":"element","tag":"a","props":{"href":"https://www.pixnet.net/","rel":["nofollow"]},"children":[{"type":"text","value":"痞客邦"}]},{"type":"text","value":" 或是 "},{"type":"element","tag":"a","props":{"href":"https://www.blogger.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Blogger.com"}]},{"type":"text","value":"，對於做為技術部落格來說，似乎不是那樣的合適，想來想去，那還是自己架設好了。"}]},{"type":"element","tag":"h2","props":{"id":"靜態網站"},"children":[{"type":"text","value":"靜態網站"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"考量到 SEO，一開始就選擇要做 SSR (Server-Side Rendering) 為主的網站；另外考量到自己可能三天打魚，兩天曬網的個性，一開始還是先不用要去租用虛擬主機或是 VPS，好了，於是就決定把部落格架在 "},{"type":"element","tag":"a","props":{"href":"https://pages.github.com/","rel":["nofollow"]},"children":[{"type":"text","value":"GitHub Pages"}]},{"type":"text","value":" 啦！"}]},{"type":"element","tag":"h2","props":{"id":"which-cms"},"children":[{"type":"text","value":"Which CMS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 GitHub Pages 上面架設部落格有很多選擇，常見的有 "},{"type":"element","tag":"a","props":{"href":"https://hexo.io/","rel":["nofollow"]},"children":[{"type":"text","value":"Hexo"}]},{"type":"text","value":"、"},{"type":"element","tag":"a","props":{"href":"https://gohugo.io/","rel":["nofollow"]},"children":[{"type":"text","value":"Hugo"}]},{"type":"text","value":"、"},{"type":"element","tag":"a","props":{"href":"https://vuepress.vuejs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Vuepress"}]},{"type":"text","value":"、"},{"type":"element","tag":"a","props":{"href":"https://www.gatsbyjs.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Gatsby"}]},{"type":"text","value":" 等，不過不知道是自己天生反骨還是怎樣，想說為了練功 (讓自己有第一篇文章可以寫)，剛好現在公司的專案是 Nuxt.js 架設的，那就乾脆使用 "},{"type":"element","tag":"a","props":{"href":"https://nuxtjs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"Nuxt.js"}]},{"type":"text","value":" 搭配它的 plugin： "},{"type":"element","tag":"a","props":{"href":"https://content.nuxtjs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"nuxt/content"}]},{"type":"text","value":"，產生靜態頁面，可以放在 GitHub Pages 上，自己來搭建一個部落格吧！"}]},{"type":"element","tag":"h2","props":{"id":"what-is-nuxtjs-nuxtcontent"},"children":[{"type":"text","value":"What is Nuxt.js & nuxt/content"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt.js 是一個以 Vue.js library 為核心的 SSR 解決方案，而 nuxt/content 則是一個可以作為一個類似 Git-based Headless CMS 的 Nuxt.js Plugin。"}]},{"type":"element","tag":"h2","props":{"id":"開始建立部落格專案"},"children":[{"type":"text","value":"開始建立部落格專案"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這邊是透過 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"create-nuxt-app"}]},{"type":"text","value":" 的方式進行 Nuxt.js 專案的建立"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"npx create-nuxt-app <project-name>\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"npx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" create-nuxt-app"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"project-nam"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"e>\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"設定的部分我就不贅述了，主要就照著 cli 上面的問題一步一步建立就好，不過為了良好的 coding 習慣，建議可以把 ESlint、Prettier 與 StyleLint 一起安裝，讓自己的程式碼更有規範。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在操作的時候可能在 cli 裡面有看到問說要不要安裝 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Content"}]},{"type":"text","value":"，這邊說的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Content"}]},{"type":"text","value":" 其實就是我們所說的 nuxt/content，如果這邊忘記選擇沒關係，建立好專案之後，在專案的跟目錄底下在下以下指令："}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Yarn:"}]}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"yarn add @nuxt/content\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" @nuxt/content\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"NPM:"}]}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"npm install @nuxt/content\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" @nuxt/content\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"text","value":" 裡面設定使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@nuxt/content"}]},{"type":"text","value":" 就大功告成啦！"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes one-dark-pro","code":"{\n  modules: [\n    '@nuxt/content'\n  ],\n  content: {\n    // Options\n  }\n}\n","filename":"nuxt.config.js","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  modules"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"    '@nuxt/content'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  ],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  content"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // Options\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之後可以先試試看在 Terminal 中輸入 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"npm run dev"}]},{"type":"text","value":" 試試看專案可不可以正常啟動，如果都沒問題就表示有成功安裝啦！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之後再來教大家如何進行 Nuxt.js 靜態頁面的編譯與 nuxt/content 的設定。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"靜態網站","depth":2,"text":"靜態網站"},{"id":"which-cms","depth":2,"text":"Which CMS"},{"id":"what-is-nuxtjs-nuxtcontent","depth":2,"text":"What is Nuxt.js & nuxt/content"},{"id":"開始建立部落格專案","depth":2,"text":"開始建立部落格專案"}]}},"_type":"markdown","_id":"content:post:20201026-build-your-blog-with-nuxt-and-nuxt-content-1.md","_source":"content","_file":"post/20201026-build-your-blog-with-nuxt-and-nuxt-content-1.md","_extension":"md","createdAt":"2020-10-28T17:14:47.000Z","updatedAt":"2024-03-04T07:46:02.000Z"},{"_path":"/post/20210619-tw-stock-punish-calendar","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"台股上市上櫃處置股 Google 行事曆 (每日更新)","description":"台股上市上櫃處置股 Google 行事曆，可直接匯入 Google Calendar 或是任何可以讀取 .ics 的行事曆軟體，每日自動更新資料","tags":"stock, google, google calendar, 台股","customCreatedAt":"2021-06-19T12:56:24.000Z","readingTime":{"text":"3 min read","minutes":2.21,"time":132600,"words":442},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之前上一篇 Nuxt.js 建立部落格的文章，超過半年了還是沒寫第二篇......"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上班太累了拉，下班之後都不想寫 (聽起來超藉口)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而且主要是因為寫完文章沒多久後就加入台股的世界 (之前最好賺的那一段整個沒參與到)，也到處加入 TG 的 Podcast 群組，跟很多不同的人學習投資的技巧。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那時候最紅的 meme 我記得是底下這張，不過後來就被航海王追過了XD\n"},{"type":"element","tag":"img","props":{"alt":"剛加入股市那時候最紅的 meme","src":"https://memeprod.sgp1.digitaloceanspaces.com/user-wtf/1595954651594.jpg"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"後來在某一次對話中發現，大家對處置股的開始結束時間都很有興趣，可是卻沒有空或是常常忘記到證交所網站查詢到底，更不用說，上市跟上櫃是要在兩個不同的網站查詢。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是我就想阿，不如就寫個爬蟲，把資料自動加到 Google Calendar 好了，想著想著，就馬上把想法化為行動，先透過 Google Apps Script 進行爬蟲，再透過資料解析，最後寫到自己公開的 Google Calendar 上就可以了，於是一個簡單的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"台股上市上櫃處置股行事曆"}]},{"type":"text","value":" 就這樣誕生了 (行事曆上面沒有記錄興櫃的股票)"}]},{"type":"element","tag":"h3","props":{"id":"即時線上展示"},"children":[{"type":"text","value":"即時線上展示"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"iframe","props":{"src":"https://calendar.google.com/calendar/embed?src=tqd81f4vfirreogp1f058gv924%40group.calendar.google.com&ctz=Asia%2FTaipei","style":"border: 0","width":"100%","height":600,"frameBorder":"0","scrolling":"no"},"children":[]},{"type":"text","value":"\n可以直接點擊上方展示行事曆右下角的 `+ Google 日曆` 按鈕，就可以加入到自己的 Google Calendar 了\n"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"ics-檔下載連結"},"children":[{"type":"text","value":"ICS 檔下載連結"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果要匯入其他行事曆軟體，這邊也有提供 ICS 格式的檔案供大家使用。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://calendar.google.com/calendar/ical/tqd81f4vfirreogp1f058gv924%40group.calendar.google.com/public/basic.ics","rel":["nofollow"]},"children":[{"type":"text","value":"下載連結"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"目前還沒有設定讓大家留言的方式，如果有遇到問題，歡迎到我的 Twitter 留言給我，我之後會把可以留言的功能補上的 (淚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://twitter.com/charlie0228","rel":["nofollow"]},"children":[{"type":"text","value":"https://twitter.com/charlie0228"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果覺得我寫的工具對您有幫助的話，歡迎不妨給小弟一點回饋。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"/donate"},"children":[{"type":"text","value":"贊助我"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"即時線上展示","depth":3,"text":"即時線上展示"},{"id":"ics-檔下載連結","depth":3,"text":"ICS 檔下載連結"}]}},"_type":"markdown","_id":"content:post:20210619-tw-stock-punish-calendar.md","_source":"content","_file":"post/20210619-tw-stock-punish-calendar.md","_extension":"md","createdAt":"2021-06-19T14:29:35.000Z","updatedAt":"2024-03-04T07:46:02.000Z"},{"_path":"/post/20240206-restart-blog","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"2024 新年新希望 重啟部落格","description":"距離上一篇文章，居然已經是三年前的東西了，沒想到當初希望好好開始寫內容，不管是程式學習相關，還是投資相關，結果居然只寫了兩篇，真是有夠沒毅力......。","tags":"閒聊","readingTime":{"text":"1 min read","minutes":0.92,"time":55200,"words":184},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"距離上一篇文章，居然已經是三年前的東西了，沒想到當初希望好好開始寫內容，不管是程式學習相關，還是投資相關，結果居然只寫了兩篇，真是有夠沒毅力......。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"是剛來重新啟動部落格了！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不過部落格剛重啟，還有一些事情要補上，這次大改版，除了版面 UI 大幅度變換之外，還把 Nuxt 也升級了，直接從 Nuxt2 變成 Nuxt3，Nuxt Content 也同時換到 V2"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"之後還要補上這些事項："}]},{"type":"element","tag":"ol","props":{"className":["contains-task-list"]},"children":[{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":true,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" 補上遺失的 Sitemap.xml"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" Dark theme"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" SEO 優化"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":true,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" 優化列表 (加上年份標記)"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":true,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" 新增文章分類標籤"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先寫下來，留下紀錄，以後才會乖乖執行XD"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:post:20240206-restart-blog.md","_source":"content","_file":"post/20240206-restart-blog.md","_extension":"md","createdAt":"2024-02-06T10:10:56.000Z","updatedAt":"2024-03-07T09:25:31.000Z"},{"_path":"/post/20240215-google-drive-download-part-migrate-in-macos","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"macOS 合併 Google Drive 壓縮下載","description":"前幾天從朋友分享的 Google Drive 連結，下載一大包檔案，因為檔案很大，超過 2GB，所以 Google 預設幫我分割檔案。因為之前都用 Windows 電腦，所以也沒發現什麼不妥，就很直覺的把檔案下載下來之後準備解壓縮。","tags":"mac, bash, google, google drive, 隨筆","readingTime":{"text":"4 min read","minutes":3.155,"time":189300,"words":631},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"前幾天從朋友分享的 Google Drive 連結，下載一大包檔案，因為檔案很大，超過 2GB，所以 Google 預設幫我分割檔案。因為之前都用 Windows 電腦，所以也沒發現什麼不妥，就很直覺的把檔案下載下來之後準備解壓縮。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"沒想到在 macOS 上解壓縮居然跟 Windows 上不一樣，因為之前都很直覺用 WinRAR 直接解開，並不會有資料夾覆蓋的問題，但是在 macOS 上，會多出很多不同的資料夾，檔案被分散開了，整理起來很不方便。於是開始線上到處搜尋，到處找解法，卻發現不知道如何下關鍵字，內容好像也很少，最後總算找到兩篇之後"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" "},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"，為了怕以後忘記，就把這篇作為部落格重開的第一篇技術文章。"}]},{"type":"element","tag":"h2","props":{"id":"步驟"},"children":[{"type":"text","value":"步驟"}]},{"type":"element","tag":"h3","props":{"id":"建立資料夾"},"children":[{"type":"text","value":"建立資料夾"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先建立一個資料夾，作為等等解壓縮後放結果的地方，這邊就命名為 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"combined"}]}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"mkdir combined\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"mkdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"unzip"},"children":[{"type":"text","value":"Unzip"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"透過 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"unzip"}]},{"type":"text","value":" 指令，將 zip 檔解開至指定的資料夾"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"unzip drive-20231126T090225Z-001.zip -d combined\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"unzip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" drive-20231126T090225Z-001.zip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -d"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣就可以順利解開囉！\n不過你會發現，咦？這樣只解開了一個啊，那我如果有幾十個檔案，不就要手動輸入幾十次指令？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這時候就可以使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" 指令，搭配萬用字元 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" 來進行多個檔案解壓縮，具體的指令如下："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"for archive in drive-20231126T090225Z-*.zip\ndo\n  unzip \"$archive\" -d combined\ndone\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" archive"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" in"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" drive-20231126T090225Z-*.zip\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  unzip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"$archive"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -d"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"done\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通常到這邊就結束拉，不過事情總是沒那麼簡單，"},{"type":"element","tag":"del","props":{},"children":[{"type":"text","value":"俗話說得好，不出意外的話就要出意外了"}]},{"type":"text","value":"如果遇到壓縮檔中含有 non-ASCII 檔名 (e.g. 中文，日文等)，就會遇到 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Illegal byte sequence"}]},{"type":"text","value":" 錯誤。"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"checkdir error:  cannot create combined/�����?��+\n                 Illegal byte sequence\n                 unable to process �����?��+/�����������-�򦵣�/�����+��+�������+����Ѣަ� ��������������࿵�����?�뮵�ֵ��ަ���� (�����ի�).pdf.\ncheckdir error:  cannot create combined/�����?��+\n                 Illegal byte sequence\n                 unable to process �����?��+/�����������-�򦵣�/�+�����֦�֢���.pdf.\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"checkdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" error:"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  cannot"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined/�����?��+\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"                 Illegal"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" byte"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" sequence\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"                 unable"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" to"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" process"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" �����?��+/�����������-�򦵣�/�����+��+�������+����Ѣަ�"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" ��������������࿵�����?�뮵�ֵ��ަ����"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" (�����ի�).pdf.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"checkdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" error:"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  cannot"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined/�����?��+\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"                 Illegal"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" byte"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" sequence\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"                 unable"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" to"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" process"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" �����?��+/�����������-�򦵣�/�+�����֦�֢���.pdf.\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那怎麼辦？這時候就要請出另一個指令，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ditto"}]},{"type":"text","value":" 來協助了。"}]},{"type":"element","tag":"h3","props":{"id":"ditto"},"children":[{"type":"text","value":"Ditto"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ditto"}]},{"type":"text","value":" 是 macOS 中的內建指令，根據 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"man ditto"}]},{"type":"text","value":" 中的說明，這個指令除了可以解壓縮，合併之外，還可以進行檔案的複製 (跟 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cp"}]},{"type":"text","value":" 指令類似)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那前面遇到 non-ASCII 的問題，透過 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"ditto"}]},{"type":"text","value":" 指令就可以處理："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"ditto -V -x -k --sequesterRsrc drive-20231126T090225Z-001.zip combined\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"ditto"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -V"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -k"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" --sequesterRsrc"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" drive-20231126T090225Z-001.zip"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"結合 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" 之後，最後完整的指令如下："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes one-dark-pro","code":"for archive in drive-20231126T090225Z-*.zip\ndo\n  ditto -V -x -k --sequesterRsrc \"$archive\" combined\ndone\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" archive"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" in"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" drive-20231126T090225Z-*.zip\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  ditto"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -V"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" -k"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" --sequesterRsrc"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"$archive"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" combined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"done\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"執行之後，一切順利，檔案成功解壓縮，名稱也都正確，也沒有出現一堆多餘的資料夾。"}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://blog.yangjerry.tw/2023/08/13/google-drive-download-part-migrate/","rel":["nofollow"]},"children":[{"type":"text","value":"macOS 合併 Google Drive 壓縮下載 - Jerry Yang's Blog"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/questions/68201952/merge-combine-multiple-downloaded-zip-files-from-google-drive-on-mac","rel":["nofollow"]},"children":[{"type":"text","value":"Merge/combine multiple downloaded ZIP-files from Google Drive on Mac [closed]"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"步驟","depth":2,"text":"步驟","children":[{"id":"建立資料夾","depth":3,"text":"建立資料夾"},{"id":"unzip","depth":3,"text":"Unzip"},{"id":"ditto","depth":3,"text":"Ditto"}]},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20240215-google-drive-download-part-migrate-in-macos.md","_source":"content","_file":"post/20240215-google-drive-download-part-migrate-in-macos.md","_extension":"md","createdAt":"2024-02-15T10:37:14.000Z","updatedAt":"2024-12-31T05:30:45.000Z"},{"_path":"/post/20240311-participating-in-the-pre-dividend-market-for-high-dividend-yield-etfs","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"參與高股息 ETF 除息前行情","description":"台灣人特愛配股配息，這幾年又大量出現高股息 ETF，從年年配，到半年配，季季配，現在連月月配的商品如雨後春筍般，瘋狂冒出。\n目前正在募集的 00940 就是屬於月月配，聽說今天第一天募集，就已經達標了，這是何等的瘋狂啊！","tags":"台股, stock, 00919, 00929, 00939, 00940, 00878, 00713, 高股息 ETF, 高股息, ETF, finlab, python","readingTime":{"text":"7 min read","minutes":6.415,"time":384900,"words":1283},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"台灣人特愛配股配息，這幾年又大量出現高股息 ETF，從年年配，到半年配，季季配，現在連月月配的商品如雨後春筍般，瘋狂冒出。\n目前正在募集的 00940 就是屬於月月配，聽說今天第一天募集，就已經達標了，這是何等的瘋狂啊！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"當然，也是有人不喜歡這類型的商品，除了可能會配到自己的本金之外，還會有可能會被扣到二代健保。\n那有人會說，可以買 ETF 的成分股啊，不過那又是另一個學問了，畢竟也不是說隨便買就會賺錢，何況 ETF 有時候市況熱的時候還會有溢價......。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"咦？溢價？"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果說大家都想參與除權息，加上市場容易把他買到溢價，那如果在除息之前買進高股息 ETF，然後除息前一天賣掉，那這樣是不是有機會賺取到資本利得，又不用被扣二代健保呢？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"說幹就幹，以下紀錄這一路回測的過程與結果，如果覺得過程太無聊，可以直接拉到最底下看結論。"}]},{"type":"element","tag":"h2","props":{"id":"決定標的"},"children":[{"type":"text","value":"決定標的"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"既然是要回測，就把高股息標的都拉出來做一輪吧，反正一檔也是做，十檔也是做。首先先到證交所網站的 "},{"type":"element","tag":"a","props":{"href":"https://www.twse.com.tw/zh/products/securities/etf/products/domestic.html","rel":["nofollow"]},"children":[{"type":"text","value":"ETF 專區"}]},{"type":"text","value":"，看一下目前國內有哪些 ETF\n"},{"type":"element","tag":"img","props":{"alt":"國內成分證券 ETF","src":"/img/20240311-twse-etf-zone.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"不看還好，一看嚇一跳，原來目前有那麼多台股 ETF 了！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接下來要做的事情就很簡單拉，把所有國內 ETF 的名稱裡面包含"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高息"}]},{"type":"text","value":"或是"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高股息"}]},{"type":"text","value":"的標的都抓出來，最後我回測的標的有這些："}]},{"type":"element","tag":"div","props":{"className":["d-flex","justify-center"]},"children":[{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"證券代號"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"證券簡稱"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0056"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"元大高股息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00701"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"國泰股利精選30"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00713"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"元大台灣高息低波"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00730"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"富邦臺灣優質高息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00731"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"復華富時高息低波"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00878"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"國泰永續高股息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00900"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"富邦特選高股息30"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00907"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"永豐優息存股"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"凱基優選高股息30"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00918"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"大華優利高填息30"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00919"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"群益台灣精選高息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00929"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"復華台灣科技優息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00930"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"永豐ESG低碳高息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00932"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"兆豐永續高息等權"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00934"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"中信成長高股息"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00935"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"野村臺灣新科技50"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00936"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"台新永續高息中小"}]}]}]}]}]},{"type":"element","tag":"div","props":{"className":["d-flex","justify-center"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-caption","text-grey","text-center"]},"children":[{"type":"text","value":"註：本文在撰寫的時候，00939 跟 00940 還沒掛牌，所以這邊不會有資料。"}]}]}]},{"type":"element","tag":"h2","props":{"id":"決定策略"},"children":[{"type":"text","value":"決定策略"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"既然都打算不參與除權息了，剩下就是決定何時要買進。這邊沒有進行很嚴格的回測，只單純就過往的經驗，往前抓個約 20 天買入，差不多是一個月的時間。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"於是一個簡單的策略就完成了，整體步驟如下："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"除息日的前 20 天 收盤 買進高股息 ETF"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"除息日的前 1 天 收盤 賣出高股息 ETF"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"就這麼簡單？是的，就是那麼簡單，但是空口無憑啊，後面還是需要做回測，才會比較精準！"}]},{"type":"element","tag":"h2","props":{"id":"取得除權息日期"},"children":[{"type":"text","value":"取得除權息日期"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"第一步先來整理一下，目前所有高股息股票過往的除權息日期，整理完檔案如下：(截至 2024-03-15)"}]},{"type":"element","tag":"div","props":{"className":["text-body-2","overflow-x-auto","text-no-wrap"]},"children":[{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"證券代號"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"除權息日期"}]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]},{"type":"element","tag":"th","props":{},"children":[]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0056"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2009-10-23"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2011-10-26"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2012-10-24"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2013-10-24"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2014-10-24"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2015-10-26"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2016-10-26"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2017-10-30"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2018-10-23"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2019-10-23"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-10-28"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-10-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-07-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-01-17"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00701"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2018-07-26"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2019-01-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-01-30"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-01-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-08-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-01-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-01-30"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-01-17"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00713"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2018-11-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2019-11-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-11-20"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-11-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-09-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-12-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-03-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00730"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2018-10-30"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2019-10-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-10-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-10-19"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00731"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2018-12-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2019-11-26"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-11-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-11-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-11-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-11-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-02-29"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00878"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2020-11-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-02-25"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-05-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-08-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2021-11-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-02-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-05-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-11-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-02-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-05-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-11-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-02-27"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00900"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-11-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-02-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-05-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-11-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-02-27"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00907"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2022-12-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-02-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-04-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-10-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-02-26"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-03-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00918"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00919"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00929"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-07-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-17"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-10-24"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-11-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-19"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-01-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-02-29"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00930"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2024-01-17"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00932"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00934"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00935"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00936"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]},{"type":"element","tag":"td","props":{},"children":[]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"資料是我到網路"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":"上抓下來的，應該不會有錯 (吧)。"}]},{"type":"element","tag":"h2","props":{"id":"回測"},"children":[{"type":"text","value":"回測"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"回測的部分，我是使用 FinLab"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":" 的 Python 套件作為股價資料來源，然後手動進行回測。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"且所有回測皆有計算手續費與證券交易稅，"},{"type":"element","tag":"strong","props":{"className":["text-red"]},"children":[{"type":"text","value":"手續費為 1.425‰ (無折扣)，ETF 交易稅為 0.1%"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其中高股息 ETF 皆不參與配息，但作為對照組的 0050 可能會跨過配息，這部分我沒有詳細去看是否有跨過 0050 的配息。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這邊放上其中一檔高股息 ETF 的詳細回測細節："}]},{"type":"element","tag":"div","props":{"className":["text-body-2","overflow-x-auto","text-no-wrap"]},"children":[{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"股票代碼"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"除息日"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"進場日"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"出場日"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"報酬率"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"0050"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"報酬率"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"進場價格"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"出場價格"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"進場日"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"週轉率"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"出場日"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"週轉率"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-03-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-02-15"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-03-15"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"1.73%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-1.43%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"16.05"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"16.39"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0.91%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0.87%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-16"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-05-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-06-15"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"7.84%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"7.45%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"17.46"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"18.90"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"1.21%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2.24%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-08-22"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-09-15"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"5.73%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2.31%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"20.40"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"21.65"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"6.37%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"10.77%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-18"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-11-21"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"2023-12-15"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"6.14%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0.48%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"21.72"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"23.14"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"1.79%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"7.26%"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後經過計算，00915 累積報酬率為：23.11%，遠高於 0050 的累積報酬率 8.87%！"}]},{"type":"element","tag":"h3","props":{"id":"累積報酬率"},"children":[{"type":"text","value":"累積報酬率"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以下附上完整的回測資料累積報酬率資料："}]},{"type":"element","tag":"div","props":{"className":["d-flex","justify-center","overflow-x-auto","text-no-wrap"]},"children":[{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"股票代碼"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"累積報酬率"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"0050"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"累積報酬率"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"0056"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"8.35%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-2.08%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00701"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"23.48%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"31.91%"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00713"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"35.30%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"16.50%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00730"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"-20.51%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-21.48%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00731"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"24.11%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"37.02%"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00878"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"25.81%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"10.98%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00900"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"25.16%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"31.81%"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00907"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-4.21%"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"0.22%"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00915"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"23.11%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"8.87%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00918"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"24.33%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"10.46%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00919"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"23.75%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"10.46%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00929"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"32.75%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"4.14%"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"00930"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-red"]},"children":[{"type":"text","value":"-1.75%"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"-1.95%"}]}]}]}]}]},{"type":"element","tag":"div","props":{"className":["d-flex","justify-center"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"span","props":{"className":["text-caption","text-grey","text-center"]},"children":[{"type":"text","value":"註：00932，00934，00935，00936 都尚未除息，所以表格中就不擺放了。"}]}]}]},{"type":"element","tag":"h2","props":{"id":"結論"},"children":[{"type":"text","value":"結論"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看起來這策略是可行的！關於這點我也很訝異，雖然一開始想說可能會有追買或是溢價的空間可以吃，但是實際上回測後又是另一個結果。不是每一檔高股息 ETF 都會表現得比 0050 好，另外，這個策略可能還是比不上持續買進並持有 0050 的報酬更佳。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"也與，在高股息 ETF 熱潮下，這種策略或許是另一種參與方式。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{"className":["text-red"]},"children":[{"type":"text","value":"所有資訊內容僅供使用者作為參考之用途，不構成任何個人或機構之意見或判斷，亦不構成任何投資建議。"}]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cnyes.com/twstock","rel":["nofollow"]},"children":[{"type":"text","value":"台股股市 - Anue 鉅亨網"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://ai.finlab.tw/","rel":["nofollow"]},"children":[{"type":"text","value":"打造成功的投資策略 - 台灣股市 Python 回測平台的分析工具"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"決定標的","depth":2,"text":"決定標的"},{"id":"決定策略","depth":2,"text":"決定策略"},{"id":"取得除權息日期","depth":2,"text":"取得除權息日期"},{"id":"回測","depth":2,"text":"回測","children":[{"id":"累積報酬率","depth":3,"text":"累積報酬率"}]},{"id":"結論","depth":2,"text":"結論"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20240311-participating-in-the-pre-dividend-market-for-high-dividend-yield-etfs.md","_source":"content","_file":"post/20240311-participating-in-the-pre-dividend-market-for-high-dividend-yield-etfs.md","_extension":"md","createdAt":"2024-03-11T10:34:33.000Z","updatedAt":"2024-03-14T16:34:14.000Z"},{"_path":"/post/20241230-nuxt-3-nested-routes","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"Nuxt3 Nested Routes 與 active class","description":"今天在處理公司專案的時候，遇到一個 Nuxt3 nested routes 小問題，剛好把它記錄下來，就當作這個 blog 2024 年最後一篇文章了 (遮臉)。","tags":"vue, nuxt, vue3, nuxt3, vue-router, 隨筆","readingTime":{"text":"2 min read","minutes":1.81,"time":108600,"words":362},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"今天在處理公司專案的時候，遇到一個 Nuxt3 nested routes 小問題，剛好把它記錄下來，就當作這個 blog 2024 年最後一篇文章了 (遮臉)。"}]},{"type":"element","tag":"h2","props":{"id":"問題描述"},"children":[{"type":"text","value":"問題描述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"公司的 Nuxt3 專案有以下的 Page 資料夾結構："}]},{"type":"element","tag":"pre","props":{"code":".\n└── pages/\n    ├── campaign/\n    │   └── [id]/\n    │       └── settings.vue\n    └── index.vue\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":".\n└── pages/\n    ├── campaign/\n    │   └── [id]/\n    │       └── settings.vue\n    └── index.vue\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"index.vue"}]},{"type":"text","value":" 這一頁使用了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<NuxtLink>"}]},{"type":"text","value":"，使用的 html 結構如下："}]},{"type":"element","tag":"pre","props":{"code":"<NuxtLink to=\"/campaign\">\n  Campaign\n</NuxtLink>\n","filename":"page/index.vue","language":"vue","meta":"","className":"language-vue shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"NuxtLink"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" to"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\"/campaign\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  Campaign\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"NuxtLink"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"並希望在頁面路由是 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/campaign/:id/settings"}]},{"type":"text","value":" 的時候，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"<NuxtLink>"}]},{"type":"text","value":" 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"active class"}]},{"type":"text","value":" 要顯示出來。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但是，很顯然的，當我發了這邊文章就表示，他並沒有正常顯示 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"active class"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"很顯然，我一定是遺漏了什麼......。"}]},{"type":"element","tag":"h2","props":{"id":"解決方法"},"children":[{"type":"text","value":"解決方法"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"經過我各種 Google 搜尋 (我想說這個問題應該不用去勞煩 "},{"type":"element","tag":"a","props":{"href":"https://chat.openai.com","rel":["nofollow"]},"children":[{"type":"text","value":"ChatGPT"}]},{"type":"text","value":" 或是 "},{"type":"element","tag":"a","props":{"href":"https://www.claude.ai","rel":["nofollow"]},"children":[{"type":"text","value":"Claude"}]},{"type":"text","value":" 了)，在 Stack Overflow 上查到了這篇文章"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":"，根據解答的說明，把資料夾的結構修改後，並新增一個 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"campaign.vue"}]},{"type":"text","value":" 頁面，問題就解決了。"}]},{"type":"element","tag":"pre","props":{"code":".\n└── pages/\n    ├── campaign/\n    │   └── [id]/\n    │       └── settings.vue\n    ├── campaign.vue\n    └── index.vue\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":".\n└── pages/\n    ├── campaign/\n    │   └── [id]/\n    │       └── settings.vue\n    ├── campaign.vue\n    └── index.vue\n"}]}]},{"type":"element","tag":"pre","props":{"code":"<template>\n  <NuxtPage />\n</template>\n","filename":"page/campaign.vue","language":"vue","meta":"","className":"language-vue shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"NuxtPage"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" />\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"打包後的差異"},"children":[{"type":"text","value":"打包後的差異"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"後來根據 Slack Overflow 解答下方的討論中，回頭去看了 Nuxt 的官方文件"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"，裡面有提到，如何讓 Nuxt 正確地把 nested routes 建立出來，後面為了確認到底這兩個設定在背後的差異為何，我到了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".nuxt/dist"}]},{"type":"text","value":" 資料夾中去翻找，證實了這兩個設定的差異。"}]},{"type":"element","tag":"h3","props":{"id":"有-nested-routes"},"children":[{"type":"text","value":"有 Nested Routes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"包含 page/campaign.vue","src":"/img/20241230-with-children-route.png"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"沒有-nested-routes"},"children":[{"type":"text","value":"沒有 Nested Routes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"不包含 page/campaign.vue","src":"/img/20241230-without-children-route.png"},"children":[]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/questions/74637529/router-link-active-nuxt-3-vuejs-on-nested-routes-not-applying-to-parent","rel":["nofollow"]},"children":[{"type":"text","value":"javascript - router-link-active Nuxt 3 / VueJS on nested routes not applying to parent - Stack Overflow"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/guide/directory-structure/pages#nested-routes","rel":["nofollow"]},"children":[{"type":"text","value":"pages/ · Nuxt Directory Structure"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"問題描述","depth":2,"text":"問題描述"},{"id":"解決方法","depth":2,"text":"解決方法"},{"id":"打包後的差異","depth":2,"text":"打包後的差異","children":[{"id":"有-nested-routes","depth":3,"text":"有 Nested Routes"},{"id":"沒有-nested-routes","depth":3,"text":"沒有 Nested Routes"}]},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20241230-nuxt-3-nested-routes.md","_source":"content","_file":"post/20241230-nuxt-3-nested-routes.md","_extension":"md","createdAt":"2024-12-30T10:16:55.000Z","updatedAt":"2024-12-31T05:30:45.000Z"},{"_path":"/post/20250122-chictrip-desktop-version-is-vue-dev-version","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"旅遊規劃網站電腦版居然是 Vue dev mode！？","description":"2025 一轉眼也快過了 1/12，趁著過年之前想說來試用看看去年各種 KOL 業配的網站，不過因為我還是習慣使用電腦，所以並沒有下載 APP，而是先使用電腦版試用看看，如果好用再來下載 APP，沒想到偶然發現了他們網站居然還是 development mode。","tags":"vue3, pinia, vue-router, 隨筆, 旅遊, 日本","readingTime":{"text":"3 min read","minutes":2.665,"time":159900,"words":533},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2025 一轉眼也快過了 1/12，趁著過年之前想說來試用看看去年各種 KOL 業配的網站，不過因為我還是習慣使用電腦，所以並沒有下載 APP，而是先使用電腦版試用看看，如果好用再來下載 APP，沒想到偶然發現了他們網站居然還是 development mode。"}]},{"type":"element","tag":"h2","props":{"id":"開端"},"children":[{"type":"text","value":"開端"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一開始發現也是單純覺得網站使用起來有點卡卡的，然後工程師魂就上身，想看看他們使用的相關套件是什麼，於是就往 Chrome extension 的圖示看上去，看看是 Vue 亮燈，還是 React 亮燈，發現是 Vue 亮燈，點擊下去發現......"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Vue.js is detected on this page.","src":"/img/20250122-vue-dev-mode-in-chictrip-desktop.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"太讓我震驚了，這是 Production site，居然是 development mode？？？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"是沒有專門 RD 在做處理，還是直接跑 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"npm dev"}]},{"type":"text","value":" 就直接上線了？"}]},{"type":"element","tag":"h2","props":{"id":"觀察"},"children":[{"type":"text","value":"觀察"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Vue.js devtools","src":"/img/20250122-vue-devtools.png","className":["mx-auto","my-0"],"style":"max-width: 32rem;"},"children":[]},{"type":"element","tag":"img","props":{"alt":"Response Headers","src":"/img/20250122-response-headers.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vue.js devtools 跟 Response Headers 上暴露太多東西了，觀察到以下內容："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"看起來網站是 Vue v3.2.47，然後是直接用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dev"}]},{"type":"text","value":" mode 進行上線，有使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Pinia"}]},{"type":"text","value":" 跟 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue-router"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i18n"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"前後端分離 (廢話)，看起來這頁沒有處理 SSR，感覺也沒打算做 SEO 的樣子"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"前端 Server 應該是放在 Azure 上"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Vue template 的註解寫得還算詳細，後面接手的人會比較容易知道裡面發生什麼事情；不過很微妙的是，這邊同時混用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Vuetify"}]},{"type":"text","value":" 跟 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Element Plus"}]},{"type":"text","value":"，前者當 base，後者看起來只使用了某些特定 component 而已。不過如果是我猜想，更像是兩個不同維護的人，做出來的結果\n"},{"type":"element","tag":"img","props":{"alt":"大量的註解","src":"/img/20250122-vue-template-in-html.png"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"首頁瀑布流照片影片都有，但是影片是直接拉影片過來，這樣載入速度真的有夠慢"},{"type":"element","tag":"br","props":{},"children":[]}]}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"寫到一半，網站變成 500 了，囧"}]}]},{"type":"element","tag":"h2","props":{"id":"take-home-message"},"children":[{"type":"text","value":"Take home message"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其實很難想像，這網站背後是這家那麼大的集團，居然會出這種包......"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"目前已經寄信回報給對方客服信箱了。同樣也警惕自己，未來如果自己製作產品，把 MVP 上線的同時，一定要特別注意是不是 dev mode 或是其他可能有安全性問題的東西意外的上線了。"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"開端","depth":2,"text":"開端"},{"id":"觀察","depth":2,"text":"觀察"},{"id":"take-home-message","depth":2,"text":"Take home message"}]}},"_type":"markdown","_id":"content:post:20250122-chictrip-desktop-version-is-vue-dev-version.md","_source":"content","_file":"post/20250122-chictrip-desktop-version-is-vue-dev-version.md","_extension":"md","createdAt":"2025-01-22T09:36:23.000Z","updatedAt":"2025-01-22T09:36:23.000Z"},{"_path":"/post/20251205-import-alias-tilde-vs-at-sign","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"Import Alias：~ vs @ 在不同框架的慣例","description":"最近在重構專案時，發現自己一直習慣用 @ 來做 import alias，但 Nuxt3 的官方文件卻都用 ~。這讓我開始好奇：這兩個符號到底有什麼差異？各個框架的慣例又是什麼？","tags":"nuxt, nuxt3, next.js, vue, react, typescript, 隨筆","customCreatedAt":"2025-12-05T00:00:00.000Z","createdByAI":true,"readingTime":{"text":"5 min read","minutes":4.445,"time":266700,"words":889},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近在重構專案時，發現自己一直習慣用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":" 來做 import alias，但 Nuxt3 的官方文件卻都用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":"。這讓我開始好奇：這兩個符號到底有什麼差異？各個框架的慣例又是什麼？"}]},{"type":"element","tag":"h2","props":{"id":"問題起源"},"children":[{"type":"text","value":"問題起源"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我從 Nuxt2 / Vue2 時代就習慣這樣寫："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"import MyComponent from '@/components/MyComponent'\nimport { api } from '@/api/request'\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" MyComponent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/components/MyComponent'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/api/request'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但在看 Nuxt3 官方文件時，卻常常看到這樣的寫法："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"import MyComponent from '~/components/MyComponent'\nimport { api } from '~/api/request'\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" MyComponent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '~/components/MyComponent'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '~/api/request'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這讓我開始懷疑：我是不是用錯了？"}]},{"type":"element","tag":"h2","props":{"id":"和-的差異"},"children":[{"type":"text","value":"~ 和 @ 的差異"}]},{"type":"element","tag":"h3","props":{"id":"在-nuxt-中"},"children":[{"type":"text","value":"在 Nuxt 中"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 2 時代"}]},{"type":"text","value":"：主要用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// Nuxt 2 常見寫法\nimport MyComponent from '@/components/MyComponent'\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// Nuxt 2 常見寫法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" MyComponent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/components/MyComponent'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 3 時代"}]},{"type":"text","value":"：官方文件主要用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// Nuxt 3 官方範例\nimport { resolveAlias } from '@nuxt/kit'\nconst resolvedPath = resolveAlias('~/components/button')\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// Nuxt 3 官方範例\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"resolveAlias"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@nuxt/kit'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resolvedPath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" resolveAlias"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'~/components/button'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但重點是："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 3 同時支援 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"text","value":"，兩者都指向專案根目錄。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你可以在 Nuxt 的官方文件"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":"中看到，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"resolveAlias"}]},{"type":"text","value":" 函式會根據 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.options.alias"}]},{"type":"text","value":" 來解析路徑，而預設的 alias 設定包含了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h3","props":{"id":"在-nextjs-中"},"children":[{"type":"text","value":"在 Next.js 中"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"根據 Next.js 官方文件"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default setup enables TypeScript, Tailwind, ESLint, App Router, and Turbopack, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"with import alias "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@/*"}]}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Next.js 預設用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// tsconfig.json (Next.js 預設)\n{\n  \"compilerOptions\": {\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@/*\": [\"./*\"]  // ← Next.js 預設\n    }\n  }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// tsconfig.json (Next.js 預設)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  \"compilerOptions\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"    \"baseUrl\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\".\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"    \"paths\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"      \"@/*\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\"./*\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ← Next.js 預設\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 使用範例\nimport Button from '@/components/Button'\nimport { api } from '@/lib/api'\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 使用範例\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" Button"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/components/Button'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"api"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/lib/api'\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"在-vite-中"},"children":[{"type":"text","value":"在 Vite 中"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Vite 本身不預設任何 alias，需要手動配置"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// vite.config.ts\nexport default defineConfig({\n  resolve: {\n    alias: {\n      '@': '/src',  // 常見做法\n      '~': '/',     // 也可以\n    }\n  }\n})\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// vite.config.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" defineConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    alias"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"      '@'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/src'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 常見做法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"      '~'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",     "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 也可以\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"各框架的慣例總結"},"children":[{"type":"text","value":"各框架的慣例總結"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"框架/工具"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"預設/推薦"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"說明"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Next.js"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"官方預設，React 生態主流"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 2"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"早期預設"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 3"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"官方文件主要用這個"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Vue CLI"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Vue 2 時代的標準"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Vite"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"無預設"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"看專案配置"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"為什麼會有這個差異"},"children":[{"type":"text","value":"為什麼會有這個差異？"}]},{"type":"element","tag":"h3","props":{"id":"的語意"},"children":[{"type":"text","value":"~ 的語意"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 在 Unix/Linux 系統中代表「home directory」，所以用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 來代表專案根目錄在語意上是合理的。"}]},{"type":"element","tag":"h3","props":{"id":"的由來"},"children":[{"type":"text","value":"@ 的由來"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":" 最早是 Webpack 的慣例，後來被 Vue CLI 和 Create React App 採用，逐漸成為 JavaScript 生態系的主流。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TypeScript 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"paths"}]},{"type":"text","value":" 設定也常用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes one-dark-pro","code":"{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@/*\": [\"./src/*\"]\n    }\n  }\n}\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  \"compilerOptions\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    \"paths\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"      \"@/*\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\"./src/*\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"我該用哪一個"},"children":[{"type":"text","value":"我該用哪一個？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個問題沒有標準答案，但我的建議是："}]},{"type":"element","tag":"h3","props":{"id":"如果你是-nuxt-專案"},"children":[{"type":"text","value":"如果你是 Nuxt 專案"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"兩個都可以，選你習慣的"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":"：符合 Nuxt3 官方文件的風格"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":"：和 React/Next.js 生態一致，團隊如果有跨框架經驗會更熟悉"}]}]},{"type":"element","tag":"h3","props":{"id":"如果你是-nextjs-專案"},"children":[{"type":"text","value":"如果你是 Next.js 專案"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"text","value":"，因為這是官方預設。"}]},{"type":"element","tag":"h3","props":{"id":"如果你是跨框架開發者"},"children":[{"type":"text","value":"如果你是跨框架開發者"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"text","value":"，因為它在整個 JavaScript 生態系更通用。"}]},{"type":"element","tag":"h2","props":{"id":"我的選擇"},"children":[{"type":"text","value":"我的選擇"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我決定繼續用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":"，理由是："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"習慣了"}]},{"type":"text","value":"：從 Nuxt2 時代就這樣寫"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"更通用"}]},{"type":"text","value":"：Next.js、Vue CLI、很多 Vite 專案都用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"團隊友善"}]},{"type":"text","value":"：如果未來有 React 開發者加入，他們會更熟悉"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt3 完全支援"}]},{"type":"text","value":"：沒有任何技術上的問題"}]}]},{"type":"element","tag":"h2","props":{"id":"實際範例"},"children":[{"type":"text","value":"實際範例"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這是我目前專案的寫法："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// api/products/api.ts\nimport { createAuthenticatedFetch } from '~/api/request'  // 用 ~ 也可以\n// 或\nimport { createAuthenticatedFetch } from '@/api/request'  // 用 @ 也可以\n\nconst { public: { API_BASE_URL } } = useRuntimeConfig()\n\nexport async function fetchProductList() {\n  const request = createAuthenticatedFetch()\n  \n  const resp = await request('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/products/api.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '~/api/request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // 用 ~ 也可以\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 或\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '@/api/request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // 用 @ 也可以\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" resp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"兩種寫法在 Nuxt3 中都完全正常運作。"}]},{"type":"element","tag":"h2","props":{"id":"總結"},"children":[{"type":"text","value":"總結"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":" 在 Nuxt3 中都可以用"}]},{"type":"text","value":"，沒有對錯之分"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Next.js 預設用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]}]},{"type":"text","value":"，這是 React 生態的主流"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"選擇你習慣的就好"}]},{"type":"text","value":"，重點是團隊內保持一致"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不需要為了符合官方文件而改變習慣"}]},{"type":"text","value":"，除非有實質的技術理由"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後，記得："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"程式碼的一致性比用哪個符號更重要"}]},{"type":"text","value":"。如果你的專案已經用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"@"}]},{"type":"text","value":" 了，就繼續用吧；如果是新專案，可以考慮用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~"}]},{"type":"text","value":" 來符合 Nuxt3 的風格。"}]},{"type":"element","tag":"h2","props":{"id":"參考資料"},"children":[{"type":"text","value":"參考資料"}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/api/kit/resolving","rel":["nofollow"]},"children":[{"type":"text","value":"Resolving - Nuxt Kit"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://nextjs.org/docs/app/building-your-application/configuring/absolute-imports-and-module-aliases","rel":["nofollow"]},"children":[{"type":"text","value":"Absolute Imports and Module Path Aliases - Next.js"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"element","tag":"a","props":{"href":"https://vitejs.dev/config/shared-options.html#resolve-alias","rel":["nofollow"]},"children":[{"type":"text","value":"Resolve Alias - Vite"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"問題起源","depth":2,"text":"問題起源"},{"id":"和-的差異","depth":2,"text":"~ 和 @ 的差異","children":[{"id":"在-nuxt-中","depth":3,"text":"在 Nuxt 中"},{"id":"在-nextjs-中","depth":3,"text":"在 Next.js 中"},{"id":"在-vite-中","depth":3,"text":"在 Vite 中"}]},{"id":"各框架的慣例總結","depth":2,"text":"各框架的慣例總結"},{"id":"為什麼會有這個差異","depth":2,"text":"為什麼會有這個差異？","children":[{"id":"的語意","depth":3,"text":"~ 的語意"},{"id":"的由來","depth":3,"text":"@ 的由來"}]},{"id":"我該用哪一個","depth":2,"text":"我該用哪一個？","children":[{"id":"如果你是-nuxt-專案","depth":3,"text":"如果你是 Nuxt 專案"},{"id":"如果你是-nextjs-專案","depth":3,"text":"如果你是 Next.js 專案"},{"id":"如果你是跨框架開發者","depth":3,"text":"如果你是跨框架開發者"}]},{"id":"我的選擇","depth":2,"text":"我的選擇"},{"id":"實際範例","depth":2,"text":"實際範例"},{"id":"總結","depth":2,"text":"總結"},{"id":"參考資料","depth":2,"text":"參考資料"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20251205-import-alias-tilde-vs-at-sign.md","_source":"content","_file":"post/20251205-import-alias-tilde-vs-at-sign.md","_extension":"md","createdAt":"2025-12-08T02:46:22.000Z","updatedAt":"2026-01-14T02:58:57.000Z"},{"_path":"/post/20251208-nuxt3-fetch-vs-axios-module-scope","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"Nuxt3 中 $fetch 與 axios 在模組頂層的差異","description":"最近在重構公司專案的 API 層時，遇到了一個有趣的問題：原本用 axios 可以正常運作的程式碼，改用 Nuxt3 的 $fetch 後卻報錯了。這個問題讓我深入研究了 $fetch 和 axios 在底層實作上的差異。","tags":"nuxt, nuxt3, vue, vue3, $fetch, axios, ofetch","createdByAI":true,"readingTime":{"text":"7 min read","minutes":6.135,"time":368100,"words":1227},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近在重構公司專案的 API 層時，遇到了一個有趣的問題：原本用 axios 可以正常運作的程式碼，改用 Nuxt3 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 後卻報錯了。這個問題讓我深入研究了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 和 axios 在底層實作上的差異。"}]},{"type":"element","tag":"h2","props":{"id":"問題描述"},"children":[{"type":"text","value":"問題描述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我的 API 層原本是這樣寫的："}]},{"type":"element","tag":"pre","props":{"code":"// api/products/api.ts\nconst { public: { API_BASE_URL } } = useRuntimeConfig()\n\nexport async function fetchProductList() {\n  const resp = await $fetch('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/products/api.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" $fetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" resp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣寫用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 完全沒問題。但當我想要透過 plugin 提供一個自訂的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$request"}]},{"type":"text","value":" 來自動帶上 Auth token 時："}]},{"type":"element","tag":"pre","props":{"code":"// plugins/request.ts\nexport default defineNuxtPlugin({\n  name: 'request',\n  setup(nuxtApp) {\n    const { $auth } = useNuxtApp()\n    \n    const request = $fetch.create({\n      async onRequest({ options }) {\n        const token = await $auth.getAccessToken()\n        if (token) {\n          options.headers.set('Authorization', `Bearer ${token}`)\n        }\n      }\n    })\n\n    nuxtApp.provide('request', request)\n  }\n})\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// plugins/request.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" defineNuxtPlugin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $fetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" onRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"getAccessToken"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"          options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'Authorization'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"`Bearer "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"`"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    nuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"provide"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然後在 API 層改用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$request"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"code":"// api/products/api.ts\nconst { public: { API_BASE_URL } } = useRuntimeConfig()\nconst { $request } = useNuxtApp()  // ❌ 這裡會出錯！\n\nexport async function fetchProductList() {\n  const resp = await $request('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/products/api.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 這裡會出錯！\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" $request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" resp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"結果瀏覽器 console 就噴錯了："}]},{"type":"element","tag":"pre","props":{"code":"TypeError: $request is not a function\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"TypeError: $request is not a function\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"奇怪的是，如果我用 axios 的話，同樣的寫法卻完全沒問題："}]},{"type":"element","tag":"pre","props":{"code":"// plugins/request.ts (axios 版本)\nimport axios from 'axios'\n\nexport default defineNuxtPlugin({\n  name: 'request',\n  setup(nuxtApp) {\n    const { $auth } = useNuxtApp()\n    \n    const request = axios.create()\n    request.interceptors.request.use(async (config) => {\n      const token = await $auth.getAccessToken()\n      if (token) {\n        config.headers.Authorization = `Bearer ${token}`\n      }\n      return config\n    })\n\n    nuxtApp.provide('request', request)\n  }\n})\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// plugins/request.ts (axios 版本)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" axios"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'axios'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" defineNuxtPlugin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"nuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" axios"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"interceptors"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"config"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"getAccessToken"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        config"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"Authorization"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" `Bearer "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"`\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" config\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    nuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"provide"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'request'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"// api/products/api.ts (axios 版本)\nconst { public: { API_BASE_URL } } = useRuntimeConfig()\nconst { $request } = useNuxtApp()  // ✅ axios 版本可以正常運作\n\nexport async function fetchProductList() {\n  const resp = await $request.get('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp.data\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/products/api.ts (axios 版本)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ axios 版本可以正常運作\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"data\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這到底是為什麼？"}]},{"type":"element","tag":"h2","props":{"id":"底層原因分析"},"children":[{"type":"text","value":"底層原因分析"}]},{"type":"element","tag":"h3","props":{"id":"fetch-是-nuxt-的-auto-import-composable"},"children":[{"type":"text","value":"$fetch 是 Nuxt 的 Auto-import Composable"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 是 Nuxt 基於 ofetch"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" 提供的全域 auto-import。根據 Nuxt 官方文件"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt uses ofetch to expose globally the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" helper for making HTTP requests within your Vue app or API routes."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"重點在於「globally」這個字。"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 本身確實是全域可用的，但透過 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.provide()"}]},{"type":"text","value":" 提供的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$request"}]},{"type":"text","value":" 卻不是。"}]},{"type":"element","tag":"h3","props":{"id":"usenuxtapp-需要在-nuxt-runtime-context-內執行3"},"children":[{"type":"text","value":"useNuxtApp() 需要在 Nuxt Runtime Context 內執行"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"當我們在模組頂層（module scope）執行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useNuxtApp()"}]},{"type":"text","value":" 時："}]},{"type":"element","tag":"pre","props":{"code":"const { $request } = useNuxtApp()  // 在模組頂層執行\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 在模組頂層執行\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這時候 Nuxt app 還沒有完全初始化，所以 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$request"}]},{"type":"text","value":" 會是 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"undefined"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但為什麼 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useRuntimeConfig()"}]},{"type":"text","value":" 可以在模組頂層執行？因為 Nuxt 在編譯時期就已經處理好 runtime config，它不需要等待 app 初始化。"}]},{"type":"element","tag":"h3","props":{"id":"axios-是普通的-javascript-物件"},"children":[{"type":"text","value":"axios 是普通的 JavaScript 物件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"axios 不同，它是一個獨立的 HTTP client library："}]},{"type":"element","tag":"pre","props":{"code":"import axios from 'axios'\n\nconst request = axios.create()  // 這是一個普通的 JavaScript 物件\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" axios"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'axios'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" axios"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 這是一個普通的 JavaScript 物件\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"當你透過 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxtApp.provide('request', request)"}]},{"type":"text","value":" 提供它時，它只是把這個物件掛到 Nuxt app 上。在模組頂層執行 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useNuxtApp()"}]},{"type":"text","value":" 時，雖然時機不對，但因為 axios instance 本身就是一個普通物件，所以還是可以正常運作。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"簡單來說："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"$fetch.create()"}]},{"type":"text","value":" 回傳的是一個需要 Nuxt context 的函式"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"axios.create()"}]},{"type":"text","value":" 回傳的是一個普通的 JavaScript 物件"}]}]},{"type":"element","tag":"h2","props":{"id":"解決方案"},"children":[{"type":"text","value":"解決方案"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"既然知道問題出在「模組頂層無法正確取得 Nuxt context」，那解決方案就很明確了："}]},{"type":"element","tag":"h3","props":{"id":"方案-1在函式內部取得-request不推薦"},"children":[{"type":"text","value":"方案 1：在函式內部取得 $request（不推薦）"}]},{"type":"element","tag":"pre","props":{"code":"export async function fetchProductList() {\n  const { $request } = useNuxtApp()  // 在函式內部執行\n  const { public: { API_BASE_URL } } = useRuntimeConfig()\n  \n  const resp = await $request('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 在函式內部執行\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" $request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" resp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣可以運作，但每個函式都要重複這段程式碼，很醜。"}]},{"type":"element","tag":"h3","props":{"id":"方案-2建立-utility-function推薦"},"children":[{"type":"text","value":"方案 2：建立 Utility Function（推薦）"}]},{"type":"element","tag":"pre","props":{"code":"// api/request.ts\nexport function createAuthenticatedFetch() {\n  const { $auth } = useNuxtApp()\n\n  return $fetch.create({\n    async onRequest({ options }) {\n      const token = await $auth.getAccessToken()\n\n      if (token) {\n        const headers = new Headers(options.headers)\n        headers.set('Authorization', `Bearer ${token}`)\n        options.headers = headers\n      }\n    },\n  })\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/request.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"$auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useNuxtApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $fetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" onRequest"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"({ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" $auth"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"getAccessToken"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"      if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" Headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'Authorization'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"`Bearer "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"token"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"`"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"headers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" headers\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"      }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"code":"// api/products/api.ts\nimport { createAuthenticatedFetch } from '~/api/request'\n\nconst { public: { API_BASE_URL } } = useRuntimeConfig()\n\nexport async function fetchProductList() {\n  const request = createAuthenticatedFetch()  // 在函式內部建立\n  \n  const resp = await request('/api/products', {\n    baseURL: API_BASE_URL,\n  })\n  return resp\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// api/products/api.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '~/api/request'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" useRuntimeConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" fetchProductList"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" createAuthenticatedFetch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()  "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 在函式內部建立\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" resp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" request"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'/api/products'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"    baseURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"API_BASE_URL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" resp\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個方案的優點："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✅ 明確看出哪些 API 需要認證"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✅ 不需要 plugin"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✅ 靈活性高（有些 API 可能不需要認證）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"✅ 符合 Nuxt 的設計理念"}]}]},{"type":"element","tag":"h3","props":{"id":"方案-3繼續用-axios"},"children":[{"type":"text","value":"方案 3：繼續用 axios"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你的專案已經在用 axios，而且運作良好，其實沒必要為了用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 而重構。axios 的 interceptor 機制很成熟，而且在這個場景下沒有明顯的劣勢。"}]},{"type":"element","tag":"h2","props":{"id":"fetch-的優勢在哪"},"children":[{"type":"text","value":"$fetch 的優勢在哪？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你可能會問：既然 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 有這些限制，為什麼還要用它？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 的優勢主要在於："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"SSR 優化"}]},{"type":"text","value":"：在 server-side 呼叫內部 API 時，會直接呼叫對應的函式，不會真的發 HTTP request"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"更輕量"}]},{"type":"text","value":"：不需要額外安裝 axios"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Nuxt 原生整合"}]},{"type":"text","value":"：自動處理 base URL、錯誤處理等"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但對於 SSG（Static Site Generation）專案來說，這些優勢就沒那麼明顯了。"}]},{"type":"element","tag":"h2","props":{"id":"總結"},"children":[{"type":"text","value":"總結"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這次的問題讓我學到："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"$fetch 是 composable，需要在正確的 context 執行"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"axios 是普通物件，可以在任何地方使用"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不要為了用新技術而重構，要看實際需求"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你的專案是 SSG，而且已經在用 axios，那就繼續用吧。如果是 SSR 專案，而且想要優化效能，那 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$fetch"}]},{"type":"text","value":" 會是更好的選擇，但要注意使用方式。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後，記得："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"工具沒有絕對的好壞，只有適不適合你的場景"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h2","props":{"id":"參考資料"},"children":[{"type":"text","value":"參考資料"}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/unjs/ofetch","rel":["nofollow"]},"children":[{"type":"text","value":"ofetch - GitHub"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/api/utils/dollarfetch","rel":["nofollow"]},"children":[{"type":"text","value":"$fetch - Nuxt"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/api/composables/use-nuxt-app","rel":["nofollow"]},"children":[{"type":"text","value":"useNuxtApp - Nuxt"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"問題描述","depth":2,"text":"問題描述"},{"id":"底層原因分析","depth":2,"text":"底層原因分析","children":[{"id":"fetch-是-nuxt-的-auto-import-composable","depth":3,"text":"$fetch 是 Nuxt 的 Auto-import Composable"},{"id":"usenuxtapp-需要在-nuxt-runtime-context-內執行3","depth":3,"text":"useNuxtApp() 需要在 Nuxt Runtime Context 內執行3"},{"id":"axios-是普通的-javascript-物件","depth":3,"text":"axios 是普通的 JavaScript 物件"}]},{"id":"解決方案","depth":2,"text":"解決方案","children":[{"id":"方案-1在函式內部取得-request不推薦","depth":3,"text":"方案 1：在函式內部取得 $request（不推薦）"},{"id":"方案-2建立-utility-function推薦","depth":3,"text":"方案 2：建立 Utility Function（推薦）"},{"id":"方案-3繼續用-axios","depth":3,"text":"方案 3：繼續用 axios"}]},{"id":"fetch-的優勢在哪","depth":2,"text":"$fetch 的優勢在哪？"},{"id":"總結","depth":2,"text":"總結"},{"id":"參考資料","depth":2,"text":"參考資料"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20251208-nuxt3-fetch-vs-axios-module-scope.md","_source":"content","_file":"post/20251208-nuxt3-fetch-vs-axios-module-scope.md","_extension":"md","createdAt":"2025-12-08T02:46:31.000Z","updatedAt":"2026-01-14T02:58:57.000Z"},{"_path":"/post/20251218-typescript-inferred-type-predicates","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"TypeScript 5.5+ Inferred Type Predicates：告別手動標註 `item is string`","description":"在開發 Vue 組件時，我遇到了一個有趣的類型推斷問題，這讓我深入研究了 TypeScript 5.5 引入的 Inferred Type Predicates 功能。","tags":"typescript, type-predicates, vue3, type-safety","customCreatedAt":"2025-12-18T00:00:00.000Z","createdByAI":true,"readingTime":{"text":"8 min read","minutes":7.42,"time":445200,"words":1484},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在開發 Vue 組件時，我遇到了一個有趣的類型推斷問題，這讓我深入研究了 TypeScript 5.5 引入的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Inferred Type Predicates"}]},{"type":"text","value":" 功能。"}]},{"type":"element","tag":"h2","props":{"id":"問題的起源"},"children":[{"type":"text","value":"問題的起源"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在開發一個下拉選單組件時，我需要處理混合的資料結構："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"interface Option {\n  label: string\n  value: string\n}\n\ninterface GroupedOption {\n  groupLabel: string\n  options: Option[]\n}\n\n// 展開後的結構：(Option | string)[]\n// string 代表分組標籤，Option 代表實際選項\nconst expandedOptions = [\n  '水果', // 分組標籤\n  { label: '蘋果', value: 'apple' }, // 選項\n  { label: '香蕉', value: 'banana' }, // 選項\n  '蔬菜', // 分組標籤\n  { label: '胡蘿蔔', value: 'carrot' } // 選項\n]\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"interface"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" GroupedOption"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  groupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"  options"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"[]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 展開後的結構：(Option | string)[]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// string 代表分組標籤，Option 代表實際選項\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" expandedOptions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  '水果'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 分組標籤\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'蘋果'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'apple'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 選項\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'香蕉'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'banana'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 選項\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  '蔬菜'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 分組標籤\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'胡蘿蔔'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'carrot'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 選項\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Vue 模板中，我需要判斷每個項目是分組標籤還是選項："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes one-dark-pro","code":"<template>\n  <template v-for=\"(item, index) in expandedOptions\" :key=\"index\">\n    <div v-if=\"typeof item === 'string'\" class=\"group-title\">\n      {{ item }}\n    </div>\n    <DropdownOption v-else :option=\"item\" />\n  </template>\n</template>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" v-for"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" expandedOptions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" :"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"key"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"index"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" v-if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\"group-title\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"      {{ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    </"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"DropdownOption"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" v-else"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" :"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" />\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  </"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"傳統的解決方案"},"children":[{"type":"text","value":"傳統的解決方案"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"為了讓程式碼更語意化，我通常會建立一個 helper function"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 傳統寫法：需要手動標註 type predicate\nfunction isGroupLabel(item: Option | string): item is string {\n  return typeof item === 'string'\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 傳統寫法：需要手動標註 type predicate\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" is"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然後在模板中使用："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes one-dark-pro","code":"<div v-if=\"isGroupLabel(item)\" class=\"group-title\">\n  {{ item }}\n</div>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" v-if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"\"group-title\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  {{ item }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"typescript-55-的革命性改進"},"children":[{"type":"text","value":"TypeScript 5.5 的革命性改進"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TypeScript 5.5 引入了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Inferred Type Predicates"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"，讓編譯器能夠自動推斷類型謂詞！"}]},{"type":"element","tag":"h3","props":{"id":"自動推斷的條件"},"children":[{"type":"text","value":"自動推斷的條件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"根據官方文檔"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":"，TypeScript 會自動推斷 type predicate，當函數滿足以下條件："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"沒有明確的回傳類型註解"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"只有單一 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" 語句且沒有隱式回傳"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不會修改參數"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"回傳與參數相關的 boolean 表達式"}]}]}]},{"type":"element","tag":"h3","props":{"id":"簡化後的寫法"},"children":[{"type":"text","value":"簡化後的寫法"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// TypeScript 5.5+ 自動推斷為: (item: Option | string) => item is string\nfunction isGroupLabel(item: Option | string) {\n  return typeof item === 'string' // 不需要手動標註！\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// TypeScript 5.5+ 自動推斷為: (item: Option | string) => item is string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":" // 不需要手動標註！\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"IDE 會自動顯示推斷出的類型："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 推斷結果：function isGroupLabel(item: string | Option): item is string\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 推斷結果：function isGroupLabel(item: string | Option): item is string\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"更多實用範例"},"children":[{"type":"text","value":"更多實用範例"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個功能適用於各種常見的類型檢查場景："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 數字檢查\nconst isNumber = (x: unknown) => typeof x === 'number'\n// 推斷為：(x: unknown) => x is number\n\n// 非空檢查\nconst isNonNullish = <T>(x: T) => x != null\n// 推斷為：<T>(x: T) => x is NonNullable<T>\n\n// 陣列過濾\nconst numbers = [1, 2, null, 4, undefined, 6]\nconst validNumbers = numbers.filter(x => x !== null && x !== undefined)\n// validNumbers 的類型自動推斷為 number[]\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 數字檢查\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isNumber"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"unknown"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'number'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 推斷為：(x: unknown) => x is number\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 非空檢查\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isNonNullish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"T"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" null\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 推斷為：<T>(x: T) => x is NonNullable<T>\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 陣列過濾\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" numbers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"6"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" validNumbers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" numbers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" &&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// validNumbers 的類型自動推斷為 number[]\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"意外的發現arrow-function-也支援"},"children":[{"type":"text","value":"意外的發現：Arrow Function 也支援！"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在實際測試中，我發現了一個有趣的現象。雖然官方文檔提到「沒有隱式回傳」的限制，但現代的 TypeScript + IDE 組合似乎已經支援 arrow function 的隱式回傳："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 這樣也能正確推斷！\nconst isGroupLabel = (item: Option | string) => typeof item === 'string'\n// IDE 顯示：(item: string | Option) => item is string\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 這樣也能正確推斷！\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// IDE 顯示：(item: string | Option) => item is string\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"什麼是隱式回傳"},"children":[{"type":"text","value":"什麼是「隱式回傳」？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"隱式回傳"}]},{"type":"text","value":"是指函數沒有明確寫 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":"，但仍然會回傳值的情況："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// ✅ 明確回傳（符合官方條件）\nfunction isGroupLabel(item: Option | string) {\n  return typeof item === 'string'\n}\n\n// ❌ 隱式回傳（官方說不支援，但實際上可以！）\nconst isGroupLabel = (item: Option | string) => typeof item === 'string'\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ 明確回傳（符合官方條件）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 隱式回傳（官方說不支援，但實際上可以！）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這可能是 TypeScript 團隊在後續版本中靜默改進的結果，讓這個功能比官方文檔描述的更加強大。"}]},{"type":"element","tag":"h2","props":{"id":"實際應用的好處"},"children":[{"type":"text","value":"實際應用的好處"}]},{"type":"element","tag":"h3","props":{"id":"_1-程式碼更簡潔"},"children":[{"type":"text","value":"1. 程式碼更簡潔"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 之前\nfunction isGroupLabel(item: Option | string): item is string {\n  return typeof item === 'string'\n}\n\n// 現在\nfunction isGroupLabel(item: Option | string) {\n  return typeof item === 'string'\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 之前\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" is"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 現在\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Option"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" typeof"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'string'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_2-類型安全不減"},"children":[{"type":"text","value":"2. 類型安全不減"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"if (isGroupLabel(item)) {\n  // TypeScript 知道這裡 item 是 string\n  item.toUpperCase() // ✅ 正常工作\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"isGroupLabel"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // TypeScript 知道這裡 item 是 string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"  item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"toUpperCase"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ 正常工作\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_3-更好的開發體驗"},"children":[{"type":"text","value":"3. 更好的開發體驗"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"IDE 自動完成更準確"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"錯誤檢查更及時"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"重構更安全"}]}]},{"type":"element","tag":"h2","props":{"id":"注意事項"},"children":[{"type":"text","value":"注意事項"}]},{"type":"element","tag":"h3","props":{"id":"truthiness-檢查的陷阱"},"children":[{"type":"text","value":"Truthiness 檢查的陷阱"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"並非所有的 boolean 回傳都會被推斷為 type predicate："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// ❌ 這不會推斷為 type predicate\nconst isValid = (score: number | undefined) => !!score\n\n// 原因：score 為 0 時回傳 false，但 0 仍然是 number\n// 如果回傳 false，score 可能是 undefined 或 0\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 這不會推斷為 type predicate\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isValid"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"score"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"score\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 原因：score 為 0 時回傳 false，但 0 仍然是 number\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 如果回傳 false，score 可能是 undefined 或 0\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"正確的寫法："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// ✅ 這會正確推斷\nconst isValid = (score: number | undefined) => score !== undefined\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ 這會正確推斷\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" isValid"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"score"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"undefined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" score"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" undefined\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"向後相容性"},"children":[{"type":"text","value":"向後相容性"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你的專案升級到 TypeScript 5.5+，某些程式碼可能會因為更精確的類型推斷而出現錯誤："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 之前：nums 類型為 (number | null)[]\n// 現在：nums 類型為 number[]\nconst nums = [1, 2, 3, null, 5].filter(x => x !== null)\n\nnums.push(null) // TypeScript 5.5+ 會報錯\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 之前：nums 類型為 (number | null)[]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 現在：nums 類型為 number[]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" nums"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"nums"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// TypeScript 5.5+ 會報錯\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"解決方法是明確標註類型："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"const nums: (number | null)[] = [1, 2, 3, null, 5].filter(x => x !== null)\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" nums"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"number"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" | "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")[] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":"5"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"filter"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" !=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"命名的學問flattenedoptions-vs-expandedoptions"},"children":[{"type":"text","value":"命名的學問：flattenedOptions vs expandedOptions"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在這次的開發過程中，我也學到了命名的重要性。對於處理分組選項的不同方式："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// flattenedOptions：扁平化 - 移除分組結構，只保留選項\nconst flattenedOptions = [\n  { label: '蘋果', value: 'apple' },\n  { label: '香蕉', value: 'banana' },\n  { label: '胡蘿蔔', value: 'carrot' }\n]\n\n// expandedOptions：展開 - 保留分組標籤並展開結構\nconst expandedOptions = [\n  '水果', // 分組標籤\n  { label: '蘋果', value: 'apple' },\n  { label: '香蕉', value: 'banana' },\n  '蔬菜', // 分組標籤\n  { label: '胡蘿蔔', value: 'carrot' }\n]\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// flattenedOptions：扁平化 - 移除分組結構，只保留選項\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" flattenedOptions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'蘋果'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'apple'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'香蕉'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'banana'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'胡蘿蔔'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'carrot'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// expandedOptions：展開 - 保留分組標籤並展開結構\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" expandedOptions"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  '水果'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 分組標籤\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'蘋果'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'apple'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'香蕉'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'banana'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"  '蔬菜'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 分組標籤\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"label"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'胡蘿蔔'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'carrot'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"好的命名能讓程式碼更容易理解和維護。"}]},{"type":"element","tag":"h2","props":{"id":"總結"},"children":[{"type":"text","value":"總結"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TypeScript 5.5 的 Inferred Type Predicates 是一個實用的改進，讓我們能夠："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"寫更少的程式碼"}]},{"type":"text","value":"：不需要手動標註 type predicate"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"保持類型安全"}]},{"type":"text","value":"：自動推斷的類型謂詞功能完整"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"提升開發體驗"}]},{"type":"text","value":"：IDE 支援更好，錯誤檢查更準確"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"而且實際使用中發現，這個功能比官方文檔描述的更強大，連 arrow function 的隱式回傳都能正確處理。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你的專案使用 TypeScript 5.5+，不妨檢查一下現有的 type predicate 函數，看看哪些可以簡化。這個小改進能讓程式碼更簡潔，同時保持完整的類型安全！"}]},{"type":"element","tag":"h2","props":{"id":"參考資料"},"children":[{"type":"text","value":"參考資料"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"延伸閱讀："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://effectivetypescript.com/2024/04/16/inferring-a-type-predicate/","rel":["nofollow"]},"children":[{"type":"text","value":"The Making of a TypeScript Feature: Inferring Type Predicates"}]},{"type":"text","value":" - 此功能的作者 Dan Vanderkam 撰寫的開發歷程，深入說明實作細節與設計考量。"}]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates","rel":["nofollow"]},"children":[{"type":"text","value":"Using type predicates - TypeScript Handbook"}]},{"type":"text","value":" - TypeScript 官方文件說明 Type Predicates 的基本概念與用法。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#inferred-type-predicates","rel":["nofollow"]},"children":[{"type":"text","value":"Inferred Type Predicates - TypeScript 5.5 Release Notes"}]},{"type":"text","value":" - TypeScript 官方文件說明 Inferred Type Predicates 的功能與使用條件。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]},{"type":"text","value":" "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2-2","ariaLabel":"Back to reference 2-2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"},{"type":"element","tag":"sup","props":{},"children":[{"type":"text","value":"2"}]}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"問題的起源","depth":2,"text":"問題的起源"},{"id":"傳統的解決方案","depth":2,"text":"傳統的解決方案"},{"id":"typescript-55-的革命性改進","depth":2,"text":"TypeScript 5.5 的革命性改進","children":[{"id":"自動推斷的條件","depth":3,"text":"自動推斷的條件"},{"id":"簡化後的寫法","depth":3,"text":"簡化後的寫法"}]},{"id":"更多實用範例","depth":2,"text":"更多實用範例"},{"id":"意外的發現arrow-function-也支援","depth":2,"text":"意外的發現：Arrow Function 也支援！","children":[{"id":"什麼是隱式回傳","depth":3,"text":"什麼是「隱式回傳」？"}]},{"id":"實際應用的好處","depth":2,"text":"實際應用的好處","children":[{"id":"_1-程式碼更簡潔","depth":3,"text":"1. 程式碼更簡潔"},{"id":"_2-類型安全不減","depth":3,"text":"2. 類型安全不減"},{"id":"_3-更好的開發體驗","depth":3,"text":"3. 更好的開發體驗"}]},{"id":"注意事項","depth":2,"text":"注意事項","children":[{"id":"truthiness-檢查的陷阱","depth":3,"text":"Truthiness 檢查的陷阱"},{"id":"向後相容性","depth":3,"text":"向後相容性"}]},{"id":"命名的學問flattenedoptions-vs-expandedoptions","depth":2,"text":"命名的學問：flattenedOptions vs expandedOptions"},{"id":"總結","depth":2,"text":"總結"},{"id":"參考資料","depth":2,"text":"參考資料"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20251218-typescript-inferred-type-predicates.md","_source":"content","_file":"post/20251218-typescript-inferred-type-predicates.md","_extension":"md","createdAt":"2025-12-18T13:38:08.000Z","updatedAt":"2026-01-14T02:58:57.000Z"},{"_path":"/post/20260106-nodejs-oom-stream-optimization","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"在 Cloud Run 被 OOM 教訓的一課：用 Stream 把記憶體從 O(N) 降到 O(1)","description":"2026 年剛開始，我就收到了一份「大禮」。","tags":"node.js, oom, memory leak, cloud run, stream, bigquery, javascript, typescript","customCreatedAt":"2026-01-06T00:00:00.000Z","createdByAI":true,"readingTime":{"text":"11 min read","minutes":10.62,"time":637200,"words":2124},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"2026 年剛開始，我就收到了一份「大禮」。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"公司內部有一個負責上傳資料到外部數據平台 (Data Partner) 的排程任務，在 Local 開發時測試幾萬筆資料都跑得好好的，結果一上線遇到 150 萬筆資料的大報表，服務直接炸開。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"GCP Log 上出現了令人絕望的 Fatal Error："}]},{"type":"element","tag":"pre","props":{"code":"FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這篇文章記錄了這次從記憶體崩潰到修復，以及最後發現架構上盲點的除錯過程。"}]},{"type":"element","tag":"h2","props":{"id":"案發經過"},"children":[{"type":"text","value":"案發經過"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們的任務很單純：從 BigQuery 撈取大量的使用者 ID (約 150 萬筆)，經過一些欄位對應 (Mapping) 後，轉成特定格式的 JSON，最後上傳到合作夥伴的 API，同時備份一份資料回資料倉儲 (Data Warehouse)。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"原本的寫法非常直覺（或者說非常天真）："}]},{"type":"element","tag":"pre","props":{"code":"// ❌ 記憶體殺手寫法\nclass Uploader {\n  private data = []\n\n  handleRow(row) {\n    // 1. 把每一筆資料都塞進 Array\n    this.data.push(transform(row)) \n  }\n\n  async finish() {\n    // 2. 最後再一次轉成 JSON 字串\n    const jsonStr = JSON.stringify(this.data)\n    \n    // 3. 寫入檔案或上傳\n    await upload(jsonStr)\n  }\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 記憶體殺手寫法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" []\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 1. 把每一筆資料都塞進 Array\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" finish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 2. 最後再一次轉成 JSON 字串\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" jsonStr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 3. 寫入檔案或上傳\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" upload"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"jsonStr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這段程式碼在處理 10 萬筆資料時可能只需要幾百 MB，但在處理 150 萬筆資料時，它在 Cloud Run (限制 2GB RAM) 上直接撞牆。"}]},{"type":"element","tag":"h2","props":{"id":"兇手是誰"},"children":[{"type":"text","value":"兇手是誰？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看看這段 Crash 當下的 Log，V8 引擎發出了最後的哀號："}]},{"type":"element","tag":"pre","props":{"code":"[1:0x520d390] 927293 ms: Mark-sweep 974.6 (1042.3) -> 972.2 (1048.3) MB, 1854.6 / 0.0 ms (average mu = 0.661, current mu = 0.347) allocation failure; scavenge might not succeed\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[1:0x520d390] 927293 ms: Mark-sweep 974.6 (1042.3) -> 972.2 (1048.3) MB, 1854.6 / 0.0 ms (average mu = 0.661, current mu = 0.347) allocation failure; scavenge might not succeed\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這行 Log 告訴我們兩件事："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"GC 已經盡力了"}]},{"type":"text","value":"：Mark-sweep (老生代垃圾回收)"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" 花了 1.8 秒，卻只回收了 2.4MB 的空間。這代表記憶體裡塞滿了「活著的物件」，GC 根本不敢動它們。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"兇手在 Stack Trace 裡"}]},{"type":"text","value":"：\n"},{"type":"element","tag":"pre","props":{"code":"v8::internal::JsonStringifier::SerializeString\nv8::internal::JsonStringify\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"v8::internal::JsonStringifier::SerializeString\nv8::internal::JsonStringify\n"}]}]},{"type":"text","value":"\n最後死在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"JSON.stringify"}]},{"type":"text","value":"。"}]}]},{"type":"element","tag":"h3","props":{"id":"為什麼會這樣"},"children":[{"type":"text","value":"為什麼會這樣？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這裡有兩個 Node.js 的記憶體殺手在作祟："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"V8 物件的成本 (Object Overhead)"}]},{"type":"text","value":"\n一個簡單的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"{ \"id\": \"123\", \"val\": 1 }"}]},{"type":"text","value":" 在 JSON 字串裡可能只佔 20 bytes，但在 V8 的 Heap 裡，它需要儲存 Hidden Class、Properties、Pointers 等中繼資料，實際佔用可能是 100 bytes 以上。150 萬個小物件加起來，記憶體佔用非常可觀。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"字串拼接的災難"}]},{"type":"text","value":"\n當我們在大陣列上呼叫 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"JSON.stringify"}]},{"type":"text","value":" 時，V8 需要一塊"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"連續"}]},{"type":"text","value":"的記憶體空間來存放產生出來的巨大字串。如果你已經用了 1.5GB 的 Ram 存 Array，這時候又要跟系統要 500MB 來存字串，系統只能跟你說：辦不到。"}]}]},{"type":"element","tag":"h2","props":{"id":"解決方案空間不夠時間來湊"},"children":[{"type":"text","value":"解決方案：空間不夠，時間來湊"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"既然不能當「大胃王」一次把資料吃完再消化，那我們就改當「迴轉壽司」：來一盤，吃一盤。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們引入了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Node.js Stream"}]},{"type":"text","value":" 的概念，搭配暫存檔案來解決這個問題。"}]},{"type":"element","tag":"h3","props":{"id":"改用串流寫入-stream-to-file"},"children":[{"type":"text","value":"改用串流寫入 (Stream to File)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"把原本的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Array.push"}]},{"type":"text","value":" 改成直接寫入 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fs.createWriteStream"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"pre","props":{"code":"// ✅ 記憶體友善寫法\nimport * as fs from 'fs'\nimport * as os from 'os'\nimport * as path from 'path'\n\nclass Uploader {\n  private writer: fs.WriteStream\n  private filePath: string\n\n  constructor() {\n    // 建立一個指向暫存目錄的寫入流\n    this.filePath = path.join(os.tmpdir(), 'temp_data.json')\n    this.writer = fs.createWriteStream(this.filePath)\n  }\n\n  handleRow(row) {\n    const item = transform(row)\n    \n    // 1. 直接轉成 JSON 字串並寫入（NDJSON 格式）\n    this.writer.write(JSON.stringify(item) + '\\n')\n    \n    // 2. 這裡 item 已經沒用了，GC 下一次掃描時就可以把它回收掉！\n  }\n\n  async finish() {\n    await new Promise<void>(resolve => this.writer.end(resolve))\n    \n    // 3. 上傳這個檔案\n    await uploadToBigQuery(this.filePath)\n  }\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ 記憶體友善寫法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" fs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'fs'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" os"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'os'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'path'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"fs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"WriteStream\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  constructor"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 建立一個指向暫存目錄的寫入流\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"os"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"tmpdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(), "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'temp_data.json'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" fs"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"createWriteStream"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 1. 直接轉成 JSON 字串並寫入（NDJSON 格式）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"write"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 2. 這裡 item 已經沒用了，GC 下一次掃描時就可以把它回收掉！\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" finish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"void"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 3. 上傳這個檔案\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" uploadToBigQuery"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個改動帶來的差異是巨大的："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Before"}]},{"type":"text","value":": 記憶體隨著資料量線性成長 (O(N))，直到爆掉。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"After"}]},{"type":"text","value":": 記憶體維持在一個低水位 (O(1))，不管資料是 100 萬筆還是 1000 萬筆，記憶體用量幾乎不變。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"因為資料一寫進檔案 (Buffer) 後，JS 物件就沒人引用了，GC 可以隨時回收它們。"}]},{"type":"element","tag":"h2","props":{"id":"暫存檔案路徑的選擇"},"children":[{"type":"text","value":"暫存檔案路徑的選擇"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"你可能會想：「直接寫 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp/temp_data.json"}]},{"type":"text","value":" 不就好了？」"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣寫在 Cloud Run 上確實可以跑，但如果你想在 Local 開發、測試，或者未來換到其他平台，就會出問題。"}]},{"type":"element","tag":"h3","props":{"id":"為什麼不能硬編碼-tmp"},"children":[{"type":"text","value":"為什麼不能硬編碼 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"？"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"環境"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"暫存目錄"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Linux / Cloud Run"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"macOS"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/var/folders/.../T"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Windows"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"C:\\Users\\xxx\\AppData\\Local\\Temp"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果你硬編碼 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"，在 Windows 上就會直接炸掉。"}]},{"type":"element","tag":"h3","props":{"id":"正確做法用-ostmpdir"},"children":[{"type":"text","value":"正確做法：用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"os.tmpdir()"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Node.js 提供了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"os.tmpdir()"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":" 這個 API，會根據作業系統自動回傳正確的暫存目錄："}]},{"type":"element","tag":"pre","props":{"code":"import * as os from 'os'\nimport * as path from 'path'\n\n// ✅ 跨平台相容\nconst tempFilePath = path.join(os.tmpdir(), 'temp_data.json')\n\n// ❌ 只能在 Linux 上跑\nconst tempFilePath = '/tmp/temp_data.json'\n\n// ❌ 相對路徑，不是真正的暫存目錄\nconst tempFilePath = 'tmp/temp_data.json'\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" os"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'os'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" *"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'path'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ✅ 跨平台相容\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" tempFilePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" path"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"join"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"os"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"tmpdir"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(), "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'temp_data.json'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 只能在 Linux 上跑\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" tempFilePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '/tmp/temp_data.json'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// ❌ 相對路徑，不是真正的暫存目錄\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" tempFilePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" 'tmp/temp_data.json'\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣不管你在 macOS 開發、Linux 部署、還是未來換到 AWS Lambda，程式碼都不用改。"}]},{"type":"element","tag":"h2","props":{"id":"backpressurewritestream-的潛在問題"},"children":[{"type":"text","value":"Backpressure：WriteStream 的潛在問題"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"用 Stream 寫檔案時，有一個容易被忽略的問題："},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Backpressure（背壓）"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"。"}]},{"type":"element","tag":"h3","props":{"id":"什麼是-backpressure"},"children":[{"type":"text","value":"什麼是 Backpressure？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"想像一個水管系統："}]},{"type":"element","tag":"pre","props":{"code":"[資料來源] → [buffer] → [磁碟寫入]\n   快速產生      暫存區      慢速消化\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"[資料來源] → [buffer] → [磁碟寫入]\n   快速產生      暫存區      慢速消化\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"當資料產生速度 > 磁碟寫入速度時："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Buffer 持續堆積"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"記憶體越吃越多"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"最終還是 OOM"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"WriteStream.write()"}]},{"type":"text","value":" 會回傳一個 boolean："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"：buffer 還有空間，繼續寫"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"false"}]},{"type":"text","value":"：buffer 滿了，應該暫停"}]}]},{"type":"element","tag":"h3","props":{"id":"目前的程式碼有問題嗎"},"children":[{"type":"text","value":"目前的程式碼有問題嗎？"}]},{"type":"element","tag":"pre","props":{"code":"// 目前的寫法：沒有檢查回傳值\nthis.writer.write(JSON.stringify(item) + '\\n')\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 目前的寫法：沒有檢查回傳值\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"write"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"理論上應該這樣處理："}]},{"type":"element","tag":"pre","props":{"code":"const ok = this.writer.write(JSON.stringify(item) + '\\n')\nif (!ok) {\n  // 暫停，等 buffer 清空\n  await new Promise(resolve => this.writer.once('drain', resolve))\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" ok"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"write"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"JSON"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"stringify"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":" '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"\\n"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"ok"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // 暫停，等 buffer 清空\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"writer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"once"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'drain'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"為什麼我選擇不處理"},"children":[{"type":"text","value":"為什麼我選擇不處理？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Cloud Run 的環境下，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":" 是 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"tmpfs"}]},{"type":"text","value":"（memory-backed filesystem），寫入速度幾乎等於記憶體速度。下游不會慢，所以 backpressure 問題不大。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但如果你的環境是："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"傳統硬碟（HDD）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"網路檔案系統（NFS）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"寫入速度受限的雲端儲存"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那就需要認真處理 backpressure 了。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"YAGNI 原則"}]},{"type":"text","value":"：先上線測試，真的遇到問題再處理。"}]},{"type":"element","tag":"h2","props":{"id":"意外發現的隱藏殺手"},"children":[{"type":"text","value":"意外發現的隱藏殺手"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在重構過程中，我還發現了原有程式碼的一個邏輯漏洞，這也是導致 OOM 的共犯。"}]},{"type":"element","tag":"pre","props":{"code":"private handleRow(row) {\n  const item = this.transform(row)\n  \n  // 原本的邏輯：先把資料塞進 Queue\n  this.rowQueue.push(item)\n  this.scheduleBatch() // 嘗試觸發上傳\n}\n\nprivate scheduleBatch() {\n  // ❌ 致命傷！\n  if (!this.sendToTarget) {\n    return \n  }\n  // ... 正常的上傳並清除 Queue 的邏輯\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // 原本的邏輯：先把資料塞進 Queue\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"  this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"rowQueue"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"  this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"scheduleBatch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 嘗試觸發上傳\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" scheduleBatch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // ❌ 致命傷！\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"sendToTarget"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // ... 正常的上傳並清除 Queue 的邏輯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個邏輯是說：如果 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"sendToTarget"}]},{"type":"text","value":" 是 false (例如我們只想跑備份不想真傳資料)，就不執行上傳。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"但問題是，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"handleRow"}]},{"type":"text","value":" 會"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"無條件"}]},{"type":"text","value":"把資料塞進 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rowQueue"}]},{"type":"text","value":"，而清理 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"rowQueue"}]},{"type":"text","value":" 的邏輯卻被 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" 擋住了！這導致這 150 萬筆資料變成了「有進沒出」的死水，直接塞爆記憶體。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"修正這類 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Logical Memory Leak"}]},{"type":"text","value":" 比優化演算法更重要："}]},{"type":"element","tag":"pre","props":{"code":"private handleRow(row) {\n  const item = this.transform(row)\n  \n  // ✅ 修正：如果不打算送，一開始就不要塞進 Queue\n  if (this.sendToTarget) {\n    this.rowQueue.push(item)\n    this.scheduleBatch()\n  }\n  // ... 其他處理（例如寫入暫存檔）\n}\n","language":"typescript","meta":"","className":"language-typescript shiki shiki-themes one-dark-pro","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"transform"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // ✅ 修正：如果不打算送，一開始就不要塞進 Queue\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"sendToTarget"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"rowQueue"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"scheduleBatch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"  // ... 其他處理（例如寫入暫存檔）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"cloud-run-的設定誤區"},"children":[{"type":"text","value":"Cloud Run 的設定誤區"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最後一點，是關於 Cloud Run 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Concurrency"}]},{"type":"text","value":" 設定"},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-4","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-4"},"children":[{"type":"text","value":"4"}]}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們原本的設定是："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Max instances: 10"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Concurrency (並行請求數): "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"80"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個設定把 Cloud Run 當成了 Web Server (處理輕量 API)。但我們的 Worker 是在處理「重型 ETL 任務」。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"試想，如果優化後單一請求需要 300MB，一個 Instance 確實可以跑得動了。但如果 Cloud Run 依照這設定，同時塞了 10 個 Request 給同一個 Instance？\n"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"300MB * 10 = 3GB"}]},{"type":"text","value":" -> "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"還是會爆"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"對於這種 Worker 類型的服務，我們把 Concurrency 降到了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"，同時也升級了 Cloud Run 的記憶體。讓 Google 幫我們水平擴展 (開新機器)，而不是在同一台機器裡互搶資源。"}]},{"type":"element","tag":"h2","props":{"id":"總結"},"children":[{"type":"text","value":"總結"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這次的 OOM 事件讓我學到了幾件事："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"不要相信 Array"}]},{"type":"text","value":"：在 Node.js 處理大量數據時，Array 是最危險的資料結構。用完即丟，讓 GC 能回收。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Stream 是好朋友"}]},{"type":"text","value":"：善用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"fs.createWriteStream"}]},{"type":"text","value":"，用硬碟空間換取寶貴的記憶體空間。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"跨平台思維"}]},{"type":"text","value":"：用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"os.tmpdir()"}]},{"type":"text","value":" 而不是硬編碼 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":"，讓程式碼在任何環境都能跑。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"了解你的環境"}]},{"type":"text","value":"：Cloud Run 的 tmpfs 讓我們可以暫時忽略 backpressure，但換個環境可能就不行了。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"注意邏輯漏洞"}]},{"type":"text","value":"：有時候 OOM 不是演算法太爛，單純是你忘記清垃圾了。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"雲端思維"}]},{"type":"text","value":"：Serverless 環境資源有限，Concurrency 設定要根據任務類型調整。"}]}]},{"type":"element","tag":"h2","props":{"id":"參考資料"},"children":[{"type":"text","value":"參考資料"}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://v8.dev/blog/trash-talk","rel":["nofollow"]},"children":[{"type":"text","value":"Trash talk: the Orinoco garbage collector - V8"}]},{"type":"text","value":" - V8 官方部落格詳細說明了 Mark-sweep 等垃圾回收演算法的運作原理。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://nodejs.org/api/os.html#ostmpdir","rel":["nofollow"]},"children":[{"type":"text","value":"OS | Node.js v22.x Documentation"}]},{"type":"text","value":" - "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"os.tmpdir()"}]},{"type":"text","value":" 會根據作業系統回傳預設的暫存目錄路徑。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"element","tag":"a","props":{"href":"https://nodejs.org/en/learn/modules/backpressuring-in-streams/","rel":["nofollow"]},"children":[{"type":"text","value":"Backpressuring in Streams - Node.js"}]},{"type":"text","value":" - Node.js 官方文件說明 Stream 中的 Backpressure 機制與處理方式。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-4"},"children":[{"type":"element","tag":"a","props":{"href":"https://cloud.google.com/run/docs/about-concurrency","rel":["nofollow"]},"children":[{"type":"text","value":"Maximum concurrent requests for services - Cloud Run"}]},{"type":"text","value":" - Google Cloud 官方文件說明 Cloud Run 的 Concurrency 設定與最佳實踐。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-4","ariaLabel":"Back to reference 4","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"案發經過","depth":2,"text":"案發經過"},{"id":"兇手是誰","depth":2,"text":"兇手是誰？","children":[{"id":"為什麼會這樣","depth":3,"text":"為什麼會這樣？"}]},{"id":"解決方案空間不夠時間來湊","depth":2,"text":"解決方案：空間不夠，時間來湊","children":[{"id":"改用串流寫入-stream-to-file","depth":3,"text":"改用串流寫入 (Stream to File)"}]},{"id":"暫存檔案路徑的選擇","depth":2,"text":"暫存檔案路徑的選擇","children":[{"id":"為什麼不能硬編碼-tmp","depth":3,"text":"為什麼不能硬編碼 /tmp？"},{"id":"正確做法用-ostmpdir","depth":3,"text":"正確做法：用 os.tmpdir()"}]},{"id":"backpressurewritestream-的潛在問題","depth":2,"text":"Backpressure：WriteStream 的潛在問題","children":[{"id":"什麼是-backpressure","depth":3,"text":"什麼是 Backpressure？"},{"id":"目前的程式碼有問題嗎","depth":3,"text":"目前的程式碼有問題嗎？"},{"id":"為什麼我選擇不處理","depth":3,"text":"為什麼我選擇不處理？"}]},{"id":"意外發現的隱藏殺手","depth":2,"text":"意外發現的隱藏殺手"},{"id":"cloud-run-的設定誤區","depth":2,"text":"Cloud Run 的設定誤區"},{"id":"總結","depth":2,"text":"總結"},{"id":"參考資料","depth":2,"text":"參考資料"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20260106-nodejs-oom-stream-optimization.md","_source":"content","_file":"post/20260106-nodejs-oom-stream-optimization.md","_extension":"md","createdAt":"2026-01-06T10:25:50.000Z","updatedAt":"2026-01-14T02:58:57.000Z"},{"_path":"/post/20260112-refactoring-data-flow-with-observer-pattern-typescript","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"使用 Observer Pattern 重構複雜的資料上傳流程 - 以 PrimaryAPI 與 BackupService 整合為例","description":"在後端開發中，我們常遇到需求不斷疊加，導致原本單純的類別（Class）變成了「上帝類別（God Class）」，職責混雜且難以測試。最近我在處理一個將資料上傳到 PrimaryAPI（主要資料平台）與 BackupService（備份服務）的功能時，就遇到了「堆疊式複雜度」的問題。本文將分享如何利用 Observer Pattern（觀察者模式）1 與 Mediator Pattern（中介者模式）2 來優化架構，達成高內聚低耦合的設計。","tags":"typescript, design-pattern, refactoring, nodejs, backend, observer-pattern","customCreatedAt":"2026-01-12T00:00:00.000Z","createdByAI":true,"readingTime":{"text":"8 min read","minutes":7.11,"time":426600,"words":1422},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在後端開發中，我們常遇到需求不斷疊加，導致原本單純的類別（Class）變成了「上帝類別（God Class）」，職責混雜且難以測試。最近我在處理一個將資料上傳到 PrimaryAPI（主要資料平台）與 BackupService（備份服務）的功能時，就遇到了「堆疊式複雜度」的問題。本文將分享如何利用 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Observer Pattern（觀察者模式）"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" 與 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mediator Pattern（中介者模式）"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":" 來優化架構，達成高內聚低耦合的設計。"}]},{"type":"element","tag":"h2","props":{"id":"問題背景"},"children":[{"type":"text","value":"📍 問題背景"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"原本的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" 類別最初只負責「將資料分批上傳到 PrimaryAPI」。隨著業務需求增加，加入了以下邏輯："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"BackupService 資料備份"}]},{"type":"text","value":"：上傳 PrimaryAPI 的同時，要判斷資料是否符合 BackupService 格式。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"寫入暫存檔"}]},{"type":"text","value":"：符合 BackupService 格式的資料要寫入暫存檔。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"上傳 BackupService"}]},{"type":"text","value":"：PrimaryAPI 上傳完成後，要把暫存檔上傳到 BackupService 平台。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"強順序性要求"}]},{"type":"text","value":"：如果 PrimaryAPI 上傳失敗，BackupService 流程必須全部中止，避免資料不一致。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這導致 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" 裡充滿了與 PrimaryAPI 無關的程式碼（寫檔、判斷 ID 格式、呼叫其他上傳服務），違反了 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"單一職責原則 (Single Responsibility Principle, SRP)"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"。"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 重構前的 God Class 示意\nclass StreamDataDriver {\n  execute() {\n    // 1. 讀取資料\n    stream.on('data', row => {\n       // 2. 處理 PrimaryAPI 上傳邏輯\n       buffer.push(row);\n       if (buffer.full) uploadToPrimary(buffer);\n\n       // 3. 處理 BackupService 邏輯 (混雜在一起!)\n       if (isBackupFormat(row)) {\n          writeToTempFile(row);\n       }\n    });\n\n    // 4. 等待所有流程結束，處理 BackupService 上傳\n    await Promise.all([primaryPromise, backupPromise]);\n  }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 重構前的 God Class 示意\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 1. 讀取資料\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    stream"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'data'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"       // 2. 處理 PrimaryAPI 上傳邏輯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"       buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"       if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"full"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"uploadToPrimary"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"       // 3. 處理 BackupService 邏輯 (混雜在一起!)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"       if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"isBackupFormat"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"          writeToTempFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"       }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 4. 等待所有流程結束，處理 BackupService 上傳\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"primaryPromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"backupPromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣的架構有幾個痛點："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"測試困難"}]},{"type":"text","value":"：要測試 PrimaryAPI 上傳邏輯，還得 Mock BackupService 的相關依賴。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"錯誤處理脆弱"}]},{"type":"text","value":"：並行執行下，很難精準控制「PrimaryAPI 失敗則 BackupService 不上傳」。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"擴充性差"}]},{"type":"text","value":"：如果明天要多傳一個 S3，程式碼會變得更亂。"}]}]},{"type":"element","tag":"h2","props":{"id":"解決方案observer-mediator"},"children":[{"type":"text","value":"🛠 解決方案：Observer + Mediator"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們決定將架構拆解，引入設計模式來分離職責。"}]},{"type":"element","tag":"h3","props":{"id":"_1-observer-pattern-觀察者模式"},"children":[{"type":"text","value":"1. Observer Pattern (觀察者模式)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先，我們將 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" 降級為單純的 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Stream Driver"}]},{"type":"text","value":"（資料流驅動者）與 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"PrimaryAPI Uploader"}]},{"type":"text","value":"。它不再關心「誰要用這些資料」，只負責廣播「我處理到一筆資料囉」。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我們定義了一個明確的介面："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 定義監聽器的合約\nexport interface IDataListener {\n    onSchemaDetermined(schemaInfo: SchemaInfo): void\n    onRowProcessed(row: Record<string, any>, transformedItem: IDataItem): void\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 定義監聽器的合約\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" interface"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onSchemaDetermined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"schemaInfo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"SchemaInfo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"void\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Record"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"transformedItem"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataItem"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"void\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"接著實作 BackupService 的專屬邏輯 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"BackupFileBuilder"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// 專門負責 BackupService 邏輯的觀察者\nexport class BackupFileBuilder implements IDataListener {\n    onRowProcessed(row: any, item: any) {\n        // 判斷是否符合 BackupService 規格\n        if (this.canWrite(row)) {\n            this.writeBackupFile(row, item);\n        }\n    }\n    // ... 其他寫檔邏輯\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// 專門負責 BackupService 邏輯的觀察者\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" BackupFileBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" implements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 判斷是否符合 BackupService 規格\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"canWrite"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"            this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"writeBackupFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // ... 其他寫檔邏輯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" 中，只需要一行程式碼通知大家："}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"class StreamDataDriver {\n    private listeners: IDataListener[] = [];\n\n    addListener(listener: IDataListener) {\n        this.listeners.push(listener);\n    }\n\n    private handleRow(row) {\n        // ... PrimaryAPI 處理邏輯 ...\n        \n        // 通知所有聽眾，完全不管他們要做什麼\n        this.listeners.forEach(l => l.onRowProcessed(row, item));\n    }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"[] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" [];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    addListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"listener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"listener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // ... PrimaryAPI 處理邏輯 ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 通知所有聽眾，完全不管他們要做什麼\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"l"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" l"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_2-mediator-pattern-中介者模式"},"children":[{"type":"text","value":"2. Mediator Pattern (中介者模式)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"雖然解耦了，但業務需求中的「強順序性（PrimaryAPI 成功 -> 才做 BackupService）」該由誰負責？這時候就需要一個 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mediator（中介者）"}]},{"type":"text","value":"。在我們的案例中，由最外層的 Action Class ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"TaskOrchestrator"}]},{"type":"text","value":") 擔任。"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"class TaskOrchestrator {\n    async execute() {\n        // 1. 建立元件\n        const uploader = new StreamDataDriver();\n        const backupBuilder = new BackupFileBuilder();\n\n        // 2. 組裝 (註冊觀察者)\n        uploader.addListener(backupBuilder);\n\n        try {\n            // 3. 執行主流程 (PrimaryAPI 上傳)\n            await uploader.execute(); \n\n            // 4. 控制流程：只有 PrimaryAPI 成功，才繼續 BackupService\n            // 從 Builder 取得準備好的暫存檔路徑\n            const result = await backupBuilder.finish();\n            \n            if (result.count > 0) {\n                 await backupUploader.execute(result.filePath);\n            }\n\n        } catch (err) {\n            // 5. 統一錯誤處理與資源清理\n            backupBuilder.cleanup();\n            throw err;\n        }\n    }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" TaskOrchestrator"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 1. 建立元件\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" BackupFileBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 2. 組裝 (註冊觀察者)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"addListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        try"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 3. 執行主流程 (PrimaryAPI 上傳)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(); \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 4. 控制流程：只有 PrimaryAPI 成功，才繼續 BackupService\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 從 Builder 取得準備好的暫存檔路徑\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"finish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"            \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"count"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" >"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" 0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"                 await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupUploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"            }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 5. 統一錯誤處理與資源清理\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"            backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"cleanup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            throw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"新舊架構比較"},"children":[{"type":"text","value":"📊 新舊架構比較"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"比較項目"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"舊架構 (Coupled / Parallel)"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"新架構 (Decoupled / Sequential)"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"責任歸屬"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"混亂"}]},{"type":"text","value":"。Class 同時負責上傳、邏輯判斷、寫檔。"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"單一職責"}]},{"type":"text","value":"。Uploader 管上傳；Builder 管資料準備；Action 管流程。"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"錯誤處理"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"脆弱"}]},{"type":"text","value":"。PrimaryAPI 失敗時難以中斷 BackupService 流程。"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"強健"}]},{"type":"text","value":"。由 Mediator 統一控制，失敗直接跳過後續步驟。"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"擴充性"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"低"}]},{"type":"text","value":"。新增功能需修改核心程式碼。"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"高"}]},{"type":"text","value":"。只需新增 Listener 即可。"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"測試難易度"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"難"}]},{"type":"text","value":"。依賴過多，Mock 困難。"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"易"}]},{"type":"text","value":"。各個元件可獨立單元測試。"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"技術反思前端-vs-後端思維"},"children":[{"type":"text","value":"💡 技術反思：前端 vs 後端思維"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"身為前端開發者轉戰後端，可能會覺得這種設計「參數傳來傳去很麻煩」或是「為什麼不直接寫在裡面就好」。但這正是後端開發與前端元件化思維的異曲同工之妙："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Listener"}]},{"type":"text","value":" 其實就像 React 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"props.onEvent"}]},{"type":"text","value":" 或 Vue 的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$emit"}]},{"type":"text","value":"。讓元件只負責發出訊號，而不負責處理後續。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Dependency Injection (DI)"}]},{"type":"text","value":" 就像是把 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"logger"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" 當作 props 傳進元件，讓元件保持純粹，方便測試。"}]}]},{"type":"element","tag":"h2","props":{"id":"總結"},"children":[{"type":"text","value":"🚀 總結"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這次重構展示了即使在業務邏輯強相依（Sequential constraint）的情況下，依然可以透過 "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Observer Pattern"}]},{"type":"text","value":" 實現程式碼層級的解耦。我們保留了 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" 作為資料流驅動者，利用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"listeners"}]},{"type":"text","value":" 陣列保留擴充性，最後透過外層的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Mediator"}]},{"type":"text","value":" 來確保業務邏輯的執行順序。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這樣的架構不僅讓目前的程式碼更乾淨，也為未來可能新增的「S3 備份」、「Log 監控」等功能預留了極佳的擴充空間。"}]},{"type":"element","tag":"h2","props":{"id":"參考資料"},"children":[{"type":"text","value":"參考資料"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"延伸閱讀："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612","rel":["nofollow"]},"children":[{"type":"text","value":"Design Patterns: Elements of Reusable Object-Oriented Software"}]},{"type":"text","value":" - Gang of Four (Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides) 於 1994 年出版的經典著作，定義了 23 種設計模式。"}]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://gameprogrammingpatterns.com/observer.html","rel":["nofollow"]},"children":[{"type":"text","value":"Observer Pattern - Game Programming Patterns"}]},{"type":"text","value":" - Observer Pattern 是 Gang of Four 定義的 23 種設計模式之一，屬於行為型模式，定義物件間的一對多依賴關係。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://springframework.guru/gang-of-four-design-patterns/mediator-pattern/","rel":["nofollow"]},"children":[{"type":"text","value":"Mediator Pattern - Spring Framework Guru"}]},{"type":"text","value":" - Mediator Pattern 透過中介者物件封裝物件間的互動，促進鬆耦合設計。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Single-responsibility_principle","rel":["nofollow"]},"children":[{"type":"text","value":"Single-responsibility principle - Wikipedia"}]},{"type":"text","value":" - Robert C. Martin 提出的 SOLID 原則之一，主張一個類別應該只有一個改變的理由。 "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"↩"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"問題背景","depth":2,"text":"📍 問題背景"},{"id":"解決方案observer-mediator","depth":2,"text":"🛠 解決方案：Observer + Mediator","children":[{"id":"_1-observer-pattern-觀察者模式","depth":3,"text":"1. Observer Pattern (觀察者模式)"},{"id":"_2-mediator-pattern-中介者模式","depth":3,"text":"2. Mediator Pattern (中介者模式)"}]},{"id":"新舊架構比較","depth":2,"text":"📊 新舊架構比較"},{"id":"技術反思前端-vs-後端思維","depth":2,"text":"💡 技術反思：前端 vs 後端思維"},{"id":"總結","depth":2,"text":"🚀 總結"},{"id":"參考資料","depth":2,"text":"參考資料"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20260112-refactoring-data-flow-with-observer-pattern-typescript.md","_source":"content","_file":"post/20260112-refactoring-data-flow-with-observer-pattern-typescript.md","_extension":"md","createdAt":"2026-01-12T08:23:38.000Z","updatedAt":"2026-01-14T02:58:57.000Z"}],"navigation":[{"title":"Post","_path":"/post","children":[{"title":"利用 Nuxt.js 與 nuxt/content 搭建部落格 (1)","_path":"/post/20201026-build-your-blog-with-nuxt-and-nuxt-content-1"},{"title":"台股上市上櫃處置股 Google 行事曆 (每日更新)","_path":"/post/20210619-tw-stock-punish-calendar"},{"title":"2024 新年新希望 重啟部落格","_path":"/post/20240206-restart-blog"},{"title":"macOS 合併 Google Drive 壓縮下載","_path":"/post/20240215-google-drive-download-part-migrate-in-macos"},{"title":"參與高股息 ETF 除息前行情","_path":"/post/20240311-participating-in-the-pre-dividend-market-for-high-dividend-yield-etfs"},{"title":"Nuxt3 Nested Routes 與 active class","_path":"/post/20241230-nuxt-3-nested-routes"},{"title":"旅遊規劃網站電腦版居然是 Vue dev mode！？","_path":"/post/20250122-chictrip-desktop-version-is-vue-dev-version"},{"title":"Import Alias：~ vs @ 在不同框架的慣例","_path":"/post/20251205-import-alias-tilde-vs-at-sign"},{"title":"Nuxt3 中 $fetch 與 axios 在模組頂層的差異","_path":"/post/20251208-nuxt3-fetch-vs-axios-module-scope"},{"title":"TypeScript 5.5+ Inferred Type Predicates：告別手動標註 `item is string`","_path":"/post/20251218-typescript-inferred-type-predicates"},{"title":"在 Cloud Run 被 OOM 教訓的一課：用 Stream 把記憶體從 O(N) 降到 O(1)","_path":"/post/20260106-nodejs-oom-stream-optimization"},{"title":"使用 Observer Pattern 重構複雜的資料上傳流程 - 以 PrimaryAPI 與 BackupService 整合為例","_path":"/post/20260112-refactoring-data-flow-with-observer-pattern-typescript"}]}]}