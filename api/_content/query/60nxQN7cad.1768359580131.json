{"_path":"/post/20260112-refactoring-data-flow-with-observer-pattern-typescript","_dir":"post","_draft":false,"_partial":false,"_locale":"","title":"ä½¿ç”¨ Observer Pattern é‡æ§‹è¤‡é›œçš„è³‡æ–™ä¸Šå‚³æµç¨‹ - ä»¥ PrimaryAPI èˆ‡ BackupService æ•´åˆç‚ºä¾‹","description":"åœ¨å¾Œç«¯é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘å¸¸é‡åˆ°éœ€æ±‚ä¸æ–·ç–ŠåŠ ï¼Œå°è‡´åŸæœ¬å–®ç´”çš„é¡åˆ¥ï¼ˆClassï¼‰è®Šæˆäº†ã€Œä¸Šå¸é¡åˆ¥ï¼ˆGod Classï¼‰ã€ï¼Œè·è²¬æ··é›œä¸”é›£ä»¥æ¸¬è©¦ã€‚æœ€è¿‘æˆ‘åœ¨è™•ç†ä¸€å€‹å°‡è³‡æ–™ä¸Šå‚³åˆ° PrimaryAPIï¼ˆä¸»è¦è³‡æ–™å¹³å°ï¼‰èˆ‡ BackupServiceï¼ˆå‚™ä»½æœå‹™ï¼‰çš„åŠŸèƒ½æ™‚ï¼Œå°±é‡åˆ°äº†ã€Œå †ç–Šå¼è¤‡é›œåº¦ã€çš„å•é¡Œã€‚æœ¬æ–‡å°‡åˆ†äº«å¦‚ä½•åˆ©ç”¨ Observer Patternï¼ˆè§€å¯Ÿè€…æ¨¡å¼ï¼‰1 èˆ‡ Mediator Patternï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰2 ä¾†å„ªåŒ–æ¶æ§‹ï¼Œé”æˆé«˜å…§èšä½è€¦åˆçš„è¨­è¨ˆã€‚","tags":"typescript, design-pattern, refactoring, nodejs, backend, observer-pattern","customCreatedAt":"2026-01-12T00:00:00.000Z","createdByAI":true,"readingTime":{"text":"8 min read","minutes":7.11,"time":426600,"words":1422},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨å¾Œç«¯é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘å¸¸é‡åˆ°éœ€æ±‚ä¸æ–·ç–ŠåŠ ï¼Œå°è‡´åŸæœ¬å–®ç´”çš„é¡åˆ¥ï¼ˆClassï¼‰è®Šæˆäº†ã€Œä¸Šå¸é¡åˆ¥ï¼ˆGod Classï¼‰ã€ï¼Œè·è²¬æ··é›œä¸”é›£ä»¥æ¸¬è©¦ã€‚æœ€è¿‘æˆ‘åœ¨è™•ç†ä¸€å€‹å°‡è³‡æ–™ä¸Šå‚³åˆ° PrimaryAPIï¼ˆä¸»è¦è³‡æ–™å¹³å°ï¼‰èˆ‡ BackupServiceï¼ˆå‚™ä»½æœå‹™ï¼‰çš„åŠŸèƒ½æ™‚ï¼Œå°±é‡åˆ°äº†ã€Œå †ç–Šå¼è¤‡é›œåº¦ã€çš„å•é¡Œã€‚æœ¬æ–‡å°‡åˆ†äº«å¦‚ä½•åˆ©ç”¨ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Observer Patternï¼ˆè§€å¯Ÿè€…æ¨¡å¼ï¼‰"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-1","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-1"},"children":[{"type":"text","value":"1"}]}]},{"type":"text","value":" èˆ‡ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mediator Patternï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-2","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-2"},"children":[{"type":"text","value":"2"}]}]},{"type":"text","value":" ä¾†å„ªåŒ–æ¶æ§‹ï¼Œé”æˆé«˜å…§èšä½è€¦åˆçš„è¨­è¨ˆã€‚"}]},{"type":"element","tag":"h2","props":{"id":"å•é¡ŒèƒŒæ™¯"},"children":[{"type":"text","value":"ğŸ“ å•é¡ŒèƒŒæ™¯"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åŸæœ¬çš„ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" é¡åˆ¥æœ€åˆåªè² è²¬ã€Œå°‡è³‡æ–™åˆ†æ‰¹ä¸Šå‚³åˆ° PrimaryAPIã€ã€‚éš¨è‘—æ¥­å‹™éœ€æ±‚å¢åŠ ï¼ŒåŠ å…¥äº†ä»¥ä¸‹é‚è¼¯ï¼š"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"BackupService è³‡æ–™å‚™ä»½"}]},{"type":"text","value":"ï¼šä¸Šå‚³ PrimaryAPI çš„åŒæ™‚ï¼Œè¦åˆ¤æ–·è³‡æ–™æ˜¯å¦ç¬¦åˆ BackupService æ ¼å¼ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"å¯«å…¥æš«å­˜æª”"}]},{"type":"text","value":"ï¼šç¬¦åˆ BackupService æ ¼å¼çš„è³‡æ–™è¦å¯«å…¥æš«å­˜æª”ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"ä¸Šå‚³ BackupService"}]},{"type":"text","value":"ï¼šPrimaryAPI ä¸Šå‚³å®Œæˆå¾Œï¼Œè¦æŠŠæš«å­˜æª”ä¸Šå‚³åˆ° BackupService å¹³å°ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"å¼·é †åºæ€§è¦æ±‚"}]},{"type":"text","value":"ï¼šå¦‚æœ PrimaryAPI ä¸Šå‚³å¤±æ•—ï¼ŒBackupService æµç¨‹å¿…é ˆå…¨éƒ¨ä¸­æ­¢ï¼Œé¿å…è³‡æ–™ä¸ä¸€è‡´ã€‚"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™å°è‡´ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" è£¡å……æ»¿äº†èˆ‡ PrimaryAPI ç„¡é—œçš„ç¨‹å¼ç¢¼ï¼ˆå¯«æª”ã€åˆ¤æ–· ID æ ¼å¼ã€å‘¼å«å…¶ä»–ä¸Šå‚³æœå‹™ï¼‰ï¼Œé•åäº† "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"å–®ä¸€è·è²¬åŸå‰‡ (Single Responsibility Principle, SRP)"}]},{"type":"element","tag":"sup","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#user-content-fn-3","ariaDescribedBy":["footnote-label"],"dataFootnoteRef":"","id":"user-content-fnref-3"},"children":[{"type":"text","value":"3"}]}]},{"type":"text","value":"ã€‚"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// é‡æ§‹å‰çš„ God Class ç¤ºæ„\nclass StreamDataDriver {\n  execute() {\n    // 1. è®€å–è³‡æ–™\n    stream.on('data', row => {\n       // 2. è™•ç† PrimaryAPI ä¸Šå‚³é‚è¼¯\n       buffer.push(row);\n       if (buffer.full) uploadToPrimary(buffer);\n\n       // 3. è™•ç† BackupService é‚è¼¯ (æ··é›œåœ¨ä¸€èµ·!)\n       if (isBackupFormat(row)) {\n          writeToTempFile(row);\n       }\n    });\n\n    // 4. ç­‰å¾…æ‰€æœ‰æµç¨‹çµæŸï¼Œè™•ç† BackupService ä¸Šå‚³\n    await Promise.all([primaryPromise, backupPromise]);\n  }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// é‡æ§‹å‰çš„ God Class ç¤ºæ„\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"  execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 1. è®€å–è³‡æ–™\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"    stream"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#98C379"},"children":[{"type":"text","value":"'data'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"       // 2. è™•ç† PrimaryAPI ä¸Šå‚³é‚è¼¯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"       buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"       if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"full"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"uploadToPrimary"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"buffer"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"       // 3. è™•ç† BackupService é‚è¼¯ (æ··é›œåœ¨ä¸€èµ·!)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"       if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"isBackupFormat"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"          writeToTempFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"       }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // 4. ç­‰å¾…æ‰€æœ‰æµç¨‹çµæŸï¼Œè™•ç† BackupService ä¸Šå‚³\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"primaryPromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"backupPromise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™æ¨£çš„æ¶æ§‹æœ‰å¹¾å€‹ç—›é»ï¼š"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ¸¬è©¦å›°é›£"}]},{"type":"text","value":"ï¼šè¦æ¸¬è©¦ PrimaryAPI ä¸Šå‚³é‚è¼¯ï¼Œé‚„å¾— Mock BackupService çš„ç›¸é—œä¾è³´ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"éŒ¯èª¤è™•ç†è„†å¼±"}]},{"type":"text","value":"ï¼šä¸¦è¡ŒåŸ·è¡Œä¸‹ï¼Œå¾ˆé›£ç²¾æº–æ§åˆ¶ã€ŒPrimaryAPI å¤±æ•—å‰‡ BackupService ä¸ä¸Šå‚³ã€ã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ“´å……æ€§å·®"}]},{"type":"text","value":"ï¼šå¦‚æœæ˜å¤©è¦å¤šå‚³ä¸€å€‹ S3ï¼Œç¨‹å¼ç¢¼æœƒè®Šå¾—æ›´äº‚ã€‚"}]}]},{"type":"element","tag":"h2","props":{"id":"è§£æ±ºæ–¹æ¡ˆobserver-mediator"},"children":[{"type":"text","value":"ğŸ›  è§£æ±ºæ–¹æ¡ˆï¼šObserver + Mediator"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æˆ‘å€‘æ±ºå®šå°‡æ¶æ§‹æ‹†è§£ï¼Œå¼•å…¥è¨­è¨ˆæ¨¡å¼ä¾†åˆ†é›¢è·è²¬ã€‚"}]},{"type":"element","tag":"h3","props":{"id":"_1-observer-pattern-è§€å¯Ÿè€…æ¨¡å¼"},"children":[{"type":"text","value":"1. Observer Pattern (è§€å¯Ÿè€…æ¨¡å¼)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é¦–å…ˆï¼Œæˆ‘å€‘å°‡ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" é™ç´šç‚ºå–®ç´”çš„ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Stream Driver"}]},{"type":"text","value":"ï¼ˆè³‡æ–™æµé©…å‹•è€…ï¼‰èˆ‡ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"PrimaryAPI Uploader"}]},{"type":"text","value":"ã€‚å®ƒä¸å†é—œå¿ƒã€Œèª°è¦ç”¨é€™äº›è³‡æ–™ã€ï¼Œåªè² è²¬å»£æ’­ã€Œæˆ‘è™•ç†åˆ°ä¸€ç­†è³‡æ–™å›‰ã€ã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æˆ‘å€‘å®šç¾©äº†ä¸€å€‹æ˜ç¢ºçš„ä»‹é¢ï¼š"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// å®šç¾©ç›£è½å™¨çš„åˆç´„\nexport interface IDataListener {\n    onSchemaDetermined(schemaInfo: SchemaInfo): void\n    onRowProcessed(row: Record<string, any>, transformedItem: IDataItem): void\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// å®šç¾©ç›£è½å™¨çš„åˆç´„\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" interface"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onSchemaDetermined"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"schemaInfo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"SchemaInfo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"void\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"Record"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":">, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"transformedItem"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataItem"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"): "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"void\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"æ¥è‘—å¯¦ä½œ BackupService çš„å°ˆå±¬é‚è¼¯ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"BackupFileBuilder"}]},{"type":"text","value":"ï¼š"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"// å°ˆé–€è² è²¬ BackupService é‚è¼¯çš„è§€å¯Ÿè€…\nexport class BackupFileBuilder implements IDataListener {\n    onRowProcessed(row: any, item: any) {\n        // åˆ¤æ–·æ˜¯å¦ç¬¦åˆ BackupService è¦æ ¼\n        if (this.canWrite(row)) {\n            this.writeBackupFile(row, item);\n        }\n    }\n    // ... å…¶ä»–å¯«æª”é‚è¼¯\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"// å°ˆé–€è² è²¬ BackupService é‚è¼¯çš„è§€å¯Ÿè€…\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" BackupFileBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" implements"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"any"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // åˆ¤æ–·æ˜¯å¦ç¬¦åˆ BackupService è¦æ ¼\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"canWrite"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"            this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"writeBackupFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"    // ... å…¶ä»–å¯«æª”é‚è¼¯\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"åœ¨ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" ä¸­ï¼Œåªéœ€è¦ä¸€è¡Œç¨‹å¼ç¢¼é€šçŸ¥å¤§å®¶ï¼š"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"class StreamDataDriver {\n    private listeners: IDataListener[] = [];\n\n    addListener(listener: IDataListener) {\n        this.listeners.push(listener);\n    }\n\n    private handleRow(row) {\n        // ... PrimaryAPI è™•ç†é‚è¼¯ ...\n        \n        // é€šçŸ¥æ‰€æœ‰è½çœ¾ï¼Œå®Œå…¨ä¸ç®¡ä»–å€‘è¦åšä»€éº¼\n        this.listeners.forEach(l => l.onRowProcessed(row, item));\n    }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"[] "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" [];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"    addListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"listener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"IDataListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"listener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    private"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" handleRow"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // ... PrimaryAPI è™•ç†é‚è¼¯ ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // é€šçŸ¥æ‰€æœ‰è½çœ¾ï¼Œå®Œå…¨ä¸ç®¡ä»–å€‘è¦åšä»€éº¼\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        this"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"listeners"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"forEach"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"l"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" =>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" l"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"onRowProcessed"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"row"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"item"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"_2-mediator-pattern-ä¸­ä»‹è€…æ¨¡å¼"},"children":[{"type":"text","value":"2. Mediator Pattern (ä¸­ä»‹è€…æ¨¡å¼)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é›–ç„¶è§£è€¦äº†ï¼Œä½†æ¥­å‹™éœ€æ±‚ä¸­çš„ã€Œå¼·é †åºæ€§ï¼ˆPrimaryAPI æˆåŠŸ -> æ‰åš BackupServiceï¼‰ã€è©²ç”±èª°è² è²¬ï¼Ÿé€™æ™‚å€™å°±éœ€è¦ä¸€å€‹ "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mediatorï¼ˆä¸­ä»‹è€…ï¼‰"}]},{"type":"text","value":"ã€‚åœ¨æˆ‘å€‘çš„æ¡ˆä¾‹ä¸­ï¼Œç”±æœ€å¤–å±¤çš„ Action Class ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"TaskOrchestrator"}]},{"type":"text","value":") æ“”ä»»ã€‚"}]},{"type":"element","tag":"pre","props":{"className":"language-typescript shiki shiki-themes one-dark-pro","code":"class TaskOrchestrator {\n    async execute() {\n        // 1. å»ºç«‹å…ƒä»¶\n        const uploader = new StreamDataDriver();\n        const backupBuilder = new BackupFileBuilder();\n\n        // 2. çµ„è£ (è¨»å†Šè§€å¯Ÿè€…)\n        uploader.addListener(backupBuilder);\n\n        try {\n            // 3. åŸ·è¡Œä¸»æµç¨‹ (PrimaryAPI ä¸Šå‚³)\n            await uploader.execute(); \n\n            // 4. æ§åˆ¶æµç¨‹ï¼šåªæœ‰ PrimaryAPI æˆåŠŸï¼Œæ‰ç¹¼çºŒ BackupService\n            // å¾ Builder å–å¾—æº–å‚™å¥½çš„æš«å­˜æª”è·¯å¾‘\n            const result = await backupBuilder.finish();\n            \n            if (result.count > 0) {\n                 await backupUploader.execute(result.filePath);\n            }\n\n        } catch (err) {\n            // 5. çµ±ä¸€éŒ¯èª¤è™•ç†èˆ‡è³‡æºæ¸…ç†\n            backupBuilder.cleanup();\n            throw err;\n        }\n    }\n}\n","language":"typescript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" TaskOrchestrator"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"    async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 1. å»ºç«‹å…ƒä»¶\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" StreamDataDriver"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":" BackupFileBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"        // 2. çµ„è£ (è¨»å†Šè§€å¯Ÿè€…)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"        uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"addListener"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"        try"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 3. åŸ·è¡Œä¸»æµç¨‹ (PrimaryAPI ä¸Šå‚³)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" uploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"(); \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 4. æ§åˆ¶æµç¨‹ï¼šåªæœ‰ PrimaryAPI æˆåŠŸï¼Œæ‰ç¹¼çºŒ BackupService\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // å¾ Builder å–å¾—æº–å‚™å¥½çš„æš«å­˜æª”è·¯å¾‘\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"finish"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"            \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"count"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#56B6C2"},"children":[{"type":"text","value":" >"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D19A66"},"children":[{"type":"text","value":" 0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"                 await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":" backupUploader"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"execute"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"result"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"filePath"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"            }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#7F848E;--shiki-default-font-style:italic"},"children":[{"type":"text","value":"            // 5. çµ±ä¸€éŒ¯èª¤è™•ç†èˆ‡è³‡æºæ¸…ç†\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E5C07B"},"children":[{"type":"text","value":"            backupBuilder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#61AFEF"},"children":[{"type":"text","value":"cleanup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#C678DD"},"children":[{"type":"text","value":"            throw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E06C75"},"children":[{"type":"text","value":" err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"        }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#ABB2BF"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"æ–°èˆŠæ¶æ§‹æ¯”è¼ƒ"},"children":[{"type":"text","value":"ğŸ“Š æ–°èˆŠæ¶æ§‹æ¯”è¼ƒ"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"æ¯”è¼ƒé …ç›®"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"èˆŠæ¶æ§‹ (Coupled / Parallel)"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"æ–°æ¶æ§‹ (Decoupled / Sequential)"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"è²¬ä»»æ­¸å±¬"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ··äº‚"}]},{"type":"text","value":"ã€‚Class åŒæ™‚è² è²¬ä¸Šå‚³ã€é‚è¼¯åˆ¤æ–·ã€å¯«æª”ã€‚"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"å–®ä¸€è·è²¬"}]},{"type":"text","value":"ã€‚Uploader ç®¡ä¸Šå‚³ï¼›Builder ç®¡è³‡æ–™æº–å‚™ï¼›Action ç®¡æµç¨‹ã€‚"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"éŒ¯èª¤è™•ç†"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"è„†å¼±"}]},{"type":"text","value":"ã€‚PrimaryAPI å¤±æ•—æ™‚é›£ä»¥ä¸­æ–· BackupService æµç¨‹ã€‚"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"å¼·å¥"}]},{"type":"text","value":"ã€‚ç”± Mediator çµ±ä¸€æ§åˆ¶ï¼Œå¤±æ•—ç›´æ¥è·³éå¾ŒçºŒæ­¥é©Ÿã€‚"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ“´å……æ€§"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"ä½"}]},{"type":"text","value":"ã€‚æ–°å¢åŠŸèƒ½éœ€ä¿®æ”¹æ ¸å¿ƒç¨‹å¼ç¢¼ã€‚"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"é«˜"}]},{"type":"text","value":"ã€‚åªéœ€æ–°å¢ Listener å³å¯ã€‚"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ¸¬è©¦é›£æ˜“åº¦"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"é›£"}]},{"type":"text","value":"ã€‚ä¾è³´éå¤šï¼ŒMock å›°é›£ã€‚"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"æ˜“"}]},{"type":"text","value":"ã€‚å„å€‹å…ƒä»¶å¯ç¨ç«‹å–®å…ƒæ¸¬è©¦ã€‚"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"æŠ€è¡“åæ€å‰ç«¯-vs-å¾Œç«¯æ€ç¶­"},"children":[{"type":"text","value":"ğŸ’¡ æŠ€è¡“åæ€ï¼šå‰ç«¯ vs å¾Œç«¯æ€ç¶­"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"èº«ç‚ºå‰ç«¯é–‹ç™¼è€…è½‰æˆ°å¾Œç«¯ï¼Œå¯èƒ½æœƒè¦ºå¾—é€™ç¨®è¨­è¨ˆã€Œåƒæ•¸å‚³ä¾†å‚³å»å¾ˆéº»ç…©ã€æˆ–æ˜¯ã€Œç‚ºä»€éº¼ä¸ç›´æ¥å¯«åœ¨è£¡é¢å°±å¥½ã€ã€‚ä½†é€™æ­£æ˜¯å¾Œç«¯é–‹ç™¼èˆ‡å‰ç«¯å…ƒä»¶åŒ–æ€ç¶­çš„ç•°æ›²åŒå·¥ä¹‹å¦™ï¼š"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Listener"}]},{"type":"text","value":" å…¶å¯¦å°±åƒ React çš„ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"props.onEvent"}]},{"type":"text","value":" æˆ– Vue çš„ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$emit"}]},{"type":"text","value":"ã€‚è®“å…ƒä»¶åªè² è²¬ç™¼å‡ºè¨Šè™Ÿï¼Œè€Œä¸è² è²¬è™•ç†å¾ŒçºŒã€‚"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Dependency Injection (DI)"}]},{"type":"text","value":" å°±åƒæ˜¯æŠŠ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"logger"}]},{"type":"text","value":" æˆ– "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config"}]},{"type":"text","value":" ç•¶ä½œ props å‚³é€²å…ƒä»¶ï¼Œè®“å…ƒä»¶ä¿æŒç´”ç²¹ï¼Œæ–¹ä¾¿æ¸¬è©¦ã€‚"}]}]},{"type":"element","tag":"h2","props":{"id":"ç¸½çµ"},"children":[{"type":"text","value":"ğŸš€ ç¸½çµ"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™æ¬¡é‡æ§‹å±•ç¤ºäº†å³ä½¿åœ¨æ¥­å‹™é‚è¼¯å¼·ç›¸ä¾ï¼ˆSequential constraintï¼‰çš„æƒ…æ³ä¸‹ï¼Œä¾ç„¶å¯ä»¥é€é "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Observer Pattern"}]},{"type":"text","value":" å¯¦ç¾ç¨‹å¼ç¢¼å±¤ç´šçš„è§£è€¦ã€‚æˆ‘å€‘ä¿ç•™äº† "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"StreamDataDriver"}]},{"type":"text","value":" ä½œç‚ºè³‡æ–™æµé©…å‹•è€…ï¼Œåˆ©ç”¨ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"listeners"}]},{"type":"text","value":" é™£åˆ—ä¿ç•™æ“´å……æ€§ï¼Œæœ€å¾Œé€éå¤–å±¤çš„ "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Mediator"}]},{"type":"text","value":" ä¾†ç¢ºä¿æ¥­å‹™é‚è¼¯çš„åŸ·è¡Œé †åºã€‚"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"é€™æ¨£çš„æ¶æ§‹ä¸åƒ…è®“ç›®å‰çš„ç¨‹å¼ç¢¼æ›´ä¹¾æ·¨ï¼Œä¹Ÿç‚ºæœªä¾†å¯èƒ½æ–°å¢çš„ã€ŒS3 å‚™ä»½ã€ã€ã€ŒLog ç›£æ§ã€ç­‰åŠŸèƒ½é ç•™äº†æ¥µä½³çš„æ“´å……ç©ºé–“ã€‚"}]},{"type":"element","tag":"h2","props":{"id":"åƒè€ƒè³‡æ–™"},"children":[{"type":"text","value":"åƒè€ƒè³‡æ–™"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"å»¶ä¼¸é–±è®€ï¼š"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612","rel":["nofollow"]},"children":[{"type":"text","value":"Design Patterns: Elements of Reusable Object-Oriented Software"}]},{"type":"text","value":" - Gang of Four (Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides) æ–¼ 1994 å¹´å‡ºç‰ˆçš„ç¶“å…¸è‘—ä½œï¼Œå®šç¾©äº† 23 ç¨®è¨­è¨ˆæ¨¡å¼ã€‚"}]}]},{"type":"element","tag":"section","props":{"className":["footnotes"],"dataFootnotes":""},"children":[{"type":"element","tag":"h2","props":{"className":["sr-only"],"id":"footnote-label"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{"id":"user-content-fn-1"},"children":[{"type":"element","tag":"a","props":{"href":"https://gameprogrammingpatterns.com/observer.html","rel":["nofollow"]},"children":[{"type":"text","value":"Observer Pattern - Game Programming Patterns"}]},{"type":"text","value":" - Observer Pattern æ˜¯ Gang of Four å®šç¾©çš„ 23 ç¨®è¨­è¨ˆæ¨¡å¼ä¹‹ä¸€ï¼Œå±¬æ–¼è¡Œç‚ºå‹æ¨¡å¼ï¼Œå®šç¾©ç‰©ä»¶é–“çš„ä¸€å°å¤šä¾è³´é—œä¿‚ã€‚ "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-1","ariaLabel":"Back to reference 1","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"â†©"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-2"},"children":[{"type":"element","tag":"a","props":{"href":"https://springframework.guru/gang-of-four-design-patterns/mediator-pattern/","rel":["nofollow"]},"children":[{"type":"text","value":"Mediator Pattern - Spring Framework Guru"}]},{"type":"text","value":" - Mediator Pattern é€éä¸­ä»‹è€…ç‰©ä»¶å°è£ç‰©ä»¶é–“çš„äº’å‹•ï¼Œä¿ƒé€²é¬†è€¦åˆè¨­è¨ˆã€‚ "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-2","ariaLabel":"Back to reference 2","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"â†©"}]}]},{"type":"element","tag":"li","props":{"id":"user-content-fn-3"},"children":[{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/Single-responsibility_principle","rel":["nofollow"]},"children":[{"type":"text","value":"Single-responsibility principle - Wikipedia"}]},{"type":"text","value":" - Robert C. Martin æå‡ºçš„ SOLID åŸå‰‡ä¹‹ä¸€ï¼Œä¸»å¼µä¸€å€‹é¡åˆ¥æ‡‰è©²åªæœ‰ä¸€å€‹æ”¹è®Šçš„ç†ç”±ã€‚ "},{"type":"element","tag":"a","props":{"href":"#user-content-fnref-3","ariaLabel":"Back to reference 3","className":["data-footnote-backref"],"dataFootnoteBackref":""},"children":[{"type":"text","value":"â†©"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"å•é¡ŒèƒŒæ™¯","depth":2,"text":"ğŸ“ å•é¡ŒèƒŒæ™¯"},{"id":"è§£æ±ºæ–¹æ¡ˆobserver-mediator","depth":2,"text":"ğŸ›  è§£æ±ºæ–¹æ¡ˆï¼šObserver + Mediator","children":[{"id":"_1-observer-pattern-è§€å¯Ÿè€…æ¨¡å¼","depth":3,"text":"1. Observer Pattern (è§€å¯Ÿè€…æ¨¡å¼)"},{"id":"_2-mediator-pattern-ä¸­ä»‹è€…æ¨¡å¼","depth":3,"text":"2. Mediator Pattern (ä¸­ä»‹è€…æ¨¡å¼)"}]},{"id":"æ–°èˆŠæ¶æ§‹æ¯”è¼ƒ","depth":2,"text":"ğŸ“Š æ–°èˆŠæ¶æ§‹æ¯”è¼ƒ"},{"id":"æŠ€è¡“åæ€å‰ç«¯-vs-å¾Œç«¯æ€ç¶­","depth":2,"text":"ğŸ’¡ æŠ€è¡“åæ€ï¼šå‰ç«¯ vs å¾Œç«¯æ€ç¶­"},{"id":"ç¸½çµ","depth":2,"text":"ğŸš€ ç¸½çµ"},{"id":"åƒè€ƒè³‡æ–™","depth":2,"text":"åƒè€ƒè³‡æ–™"},{"id":"footnote-label","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:post:20260112-refactoring-data-flow-with-observer-pattern-typescript.md","_source":"content","_file":"post/20260112-refactoring-data-flow-with-observer-pattern-typescript.md","_extension":"md","createdAt":"2026-01-12T08:23:38.000Z","updatedAt":"2026-01-14T02:58:57.000Z"}